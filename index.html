<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>딱필모 — 학생용 큐레이션 포털</title>
  <meta name="description" content="대한민국 학생들을 위한 엄선된 학습·참고·진로 사이트 모음 — 전문가 추천, 시기별/학년별 큐레이션과 활용 가이드 제공" />
  <meta name="author" content="딱필모" />
  <meta name="keywords" content="학생,학습,참고자료,수능,강의,큐레이션,교사추천" />
  <!-- Open Graph -->
  <meta property="og:title" content="딱필모 — 학생용 큐레이션 포털" />
  <meta property="og:description" content="대한민국 학생들을 위한 엄선된 학습·참고·진로 사이트 모음" />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="ko_KR" />
  <!-- JSON-LD 구조화 데이터 (사이트 개요) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "딱필모",
    "url": "https://example.com/",
    "description": "대한민국 학생들을 위한 엄선된 학습·참고·진로 사이트 모음",
    "inLanguage": "ko-KR"
  }
  </script>

  <style>
    :root{
      --bg1: #f5f7fb;
      --card: #fff;
      --muted:#6c757d;
      --accent1:#6c63ff;
      --accent2:#7b61ff;
      --glass: rgba(255,255,255,0.6);
      --radius:14px;
    }
    [data-theme="dark"]{
      --bg1:#0f141a;
      --card:#121416;
      --muted:#9aa3b2;
      --accent1:#7b61ff;
      --accent2:#5a41d6;
      --glass: rgba(20,20,30,0.6);
    }
    html,body{height:100%;margin:0;font-family:Inter, "Noto Sans KR", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    body{background:linear-gradient(180deg,var(--bg1),#e9eef9 60%);padding:20px;transition:background .3s,color .3s;}
    .app{max-width:1200px;margin:0 auto;background:var(--glass);border-radius:18px;padding:16px;box-shadow:0 20px 40px rgba(2,6,23,0.12);backdrop-filter: blur(6px);}
    header{display:flex;align-items:center;gap:12px;padding:16px 8px;}
    .logo{display:flex;align-items:center;gap:10px;}
    .logo h1{margin:0;font-size:1.4rem;letter-spacing:-0.5px;}
    .controls{margin-left:auto;display:flex;gap:8px;align-items:center;}
    input.search{padding:10px 12px;border-radius:12px;border:1px solid rgba(0,0,0,0.08);min-width:220px;box-shadow:inset 0 1px 0 rgba(255,255,255,0.4);transition:box-shadow .12s, border-color .12s;}
    input.search:focus{outline:none;border-color:var(--accent1);box-shadow:0 6px 18px rgba(99,88,255,0.12);}
    .btn{padding:9px 12px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;font-weight:600;cursor:pointer;}
    .btn.ghost{background:transparent;color:var(--muted);border:1px solid rgba(0,0,0,0.06);}
    nav.tabs{display:flex;gap:8px;padding:12px 8px;flex-wrap:wrap;}
    .tab{padding:8px 12px;border-radius:999px;background:transparent;border:1px solid rgba(0,0,0,0.04);cursor:pointer;}
    .tab.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;border-color:transparent;box-shadow:0 8px 30px rgba(99,88,255,0.12);}

    /* grid */
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;padding:14px;}
    .card{background:var(--card);border-radius:12px;padding:14px;border:1px solid rgba(0,0,0,0.04);position:relative;transition:transform .14s ease,box-shadow .14s;}
    .card:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(48,45,73,0.08);}
    .card .title{font-weight:800;font-size:1.05rem;display:flex;gap:8px;align-items:center;}
    .desc{color:var(--muted);font-size:0.95rem;margin-top:6px;}
    .meta{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;}
    .tag{padding:6px 8px;border-radius:10px;background:linear-gradient(180deg,#f1f3ff,#fff);font-weight:700;font-size:12px;color:#333;}
    [data-theme="dark"] .tag{background:linear-gradient(180deg,#2b2c3a,#23232f);color:#fff;}

    /* actions */
    .card-actions{position:absolute;right:12px;top:12px;display:flex;gap:6px;}
    .icon-btn{width:36px;height:36px;border-radius:10px;border:none;background:transparent;display:inline-flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px;}
    .icon-btn.q{background:linear-gradient(90deg,rgba(99,88,255,0.1),rgba(123,97,255,0.08));}
    .icon-btn.bookmark{background:linear-gradient(90deg,rgba(255,210,64,0.08),rgba(255,150,0,0.06));}

    /* guide panel */
    .guide-panel{padding:12px;border-radius:12px;background:linear-gradient(180deg,#fff,#fbfbff);margin:6px 0;border:1px solid rgba(0,0,0,0.04);}
    [data-theme="dark"] .guide-panel{background:linear-gradient(180deg,#1b1b2a,#14141b);}

    /* preview modal */
    .modal{position:fixed;left:0;top:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:rgba(2,6,23,0.5);z-index:999;opacity:0;pointer-events:none;transition:opacity .12s;}
    .modal.open{opacity:1;pointer-events:auto;}
    .modal .box{width:90%;max-width:1100px;height:80%;background:var(--card);border-radius:12px;overflow:hidden;display:flex;flex-direction:column;}
    .modal .frame{flex:1;border:0;}
    .modal .modal-head{padding:12px 14px;display:flex;align-items:center;gap:8px;border-bottom:1px solid rgba(0,0,0,0.04);}
    .modal .modal-head .title{font-weight:800;}
    .close-x{margin-left:auto;background:transparent;border:none;font-size:18px;padding:6px;cursor:pointer;}

    /* loading spinner */
    .spinner{width:36px;height:36px;border-radius:50%;border:4px solid rgba(0,0,0,0.06);border-top-color:var(--accent1);animation:spin 1s linear infinite;}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* drag handle */
    .drag-handle{cursor:grab;padding:6px;border-radius:8px;border:1px dashed rgba(0,0,0,0.04);background:transparent;font-size:13px;color:var(--muted);display:inline-flex;align-items:center;gap:6px;}
    .dragging{opacity:0.6;transform:scale(.98) rotate(-1deg);}

    /* small responsive */
    @media (max-width:640px){ .controls{flex-direction:column;gap:6px} input.search{width:100%} .modal .box{height:90%} }

    /* micro interactions */
    .pulse{animation:pulse 2.2s infinite;}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.02)}100%{transform:scale(1)}}
  </style>
</head>
<body data-theme="light">
  <div class="app" role="main" aria-live="polite">
    <header>
      <div class="logo">
        <div style="font-size:1.8rem">🌟</div>
        <div>
          <h1>딱필모</h1>
          <div style="font-size:12px;color:var(--muted)">학생들을 위한 엄선된 사이트 & 실전 가이드</div>
        </div>
      </div>

      <div class="controls" aria-hidden="false">
        <input id="search" class="search" placeholder="사이트 이름/설명 검색 — '/' 키를 눌러 바로 검색" autocomplete="off" />
        <button id="guideToggle" class="btn ghost" title="가이드 보이기/숨기기">가이드 토글 (G)</button>
        <button id="themeToggle" class="btn" title="다크 모드 전환 (D)">다크모드</button>
      </div>
    </header>

    <nav class="tabs" id="tabs">
      <button class="tab active" data-tab="expert">교사/전문가 추천</button>
      <button class="tab" data-tab="season">시기별 추천</button>
      <button class="tab" data-tab="grade">학년별 추천</button>
      <button class="tab" data-tab="all">전체</button>
    </nav>

    <section id="guideArea" class="guide-panel" aria-hidden="false">
      <strong>가이드 요약</strong>
      <div id="guideSummary" style="margin-top:8px;color:var(--muted);">
        — 각 사이트별 활용법, 시험/방학에 따른 추천, 과목별 조합 팁을 카드에서 확인하세요.
      </div>
    </section>

    <main>
      <div id="grid" class="grid" aria-live="polite"></div>
    </main>
  </div>

  <!-- preview modal -->
  <div id="previewModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="box" role="document">
      <div class="modal-head">
        <div class="title" id="modalTitle">사이트 미리보기</div>
        <button class="close-x" id="closePreview">✕</button>
      </div>
      <iframe id="previewFrame" class="frame" title="사이트 미리보기"></iframe>
    </div>
  </div>

  <script>
  /***********************
   * 초기 데이터 정의 (사이트 + 가이드 + 메타)
   ***********************/
  const initialSites = [
    {
      id: 'ebs',
      name:'EBS 초등/중/고',
      url:'https://www.ebs.co.kr',
      category:'learning',
      ages:['elem','mid','high'],
      subjects:['korean','math','science','social'],
      guide: 'EBS는 수능/교과 연계 자료가 풍부합니다. 과목별 짧은 강의로 요약 학습에 적합합니다. 추천 사용법: ① 관심 과목 프리패스 강의 골라보기 ② 모의고사 강의로 약점 보완',
      tips: ['교과서 단원에 맞춰 영상 재생','노트에 요점 정리 후 복습','모의고사 전 EBS 연계 문제 확인'],
      expert:true
    },
    {
      id: 'khan',
      name:'Khan Academy (한국어)',
      url:'https://ko.khanacademy.org/',
      category:'learning',
      ages:['mid','high','adult'],
      subjects:['math','science'],
      guide:'기초 개념을 쉬운 설명으로 다지고 싶은 학생에게 최적. 단계별 문제풀이가 체계적입니다.',
      tips:['수학 개념은 예제 먼저 풀어보기','영상 보며 손으로 직접 풀기'],
      expert:false
    },
    {
      id: 'programmers',
      name:'프로그래머스',
      url:'https://programmers.co.kr/',
      category:'coding',
      ages:['high','adult'],
      subjects:['coding'],
      guide:'코딩 기초부터 실무형 문제까지. 알고리즘 연습으로 문제 해결 능력 강화.',
      tips:['난이도별 루틴 만들기','문제 해결 후 해설 정리'],
      expert:true
    },
    {
      id: 'naver',
      name:'네이버',
      url:'https://www.naver.com/',
      category:'search',
      ages:['elem','mid','high','adult'],
      subjects:['general'],
      guide:'일상적 검색, 사전, 지식인 이용. 리포트 자료 찾을 때 출처 확인 필수.',
      tips:['검색어에 따옴표 사용','고급검색(기간/도메인) 활용'],
      expert:false
    },
    {
      id: 'kice',
      name:'한국교육과정평가원 (수능/기출)',
      url:'https://www.kice.re.kr/',
      category:'exam',
      ages:['high'],
      subjects:['exam'],
      guide:'수능/모의고사 자료, 기출 확인 필수. 기출분석으로 출제경향 파악하기.',
      tips:['기출문제를 시간 재고 풀기','오답노트로 유형 분류'],
      examSeason:true,
      expert:true
    }
  ];

  // 로컬 상태 (sites 실제 사용 데이터)
  let sites = [];
  // 선택/포커스 상태
  let focusedIndex = 0;
  // 현재 탭
  let currentTab = 'expert';

  /***********************
   * 초기화
   ***********************/
  function init(){
    // load saved order/data
    const saved = localStorage.getItem('dfm_sites_v1');
    if(saved){
      try{
        const parsed = JSON.parse(saved);
        if(Array.isArray(parsed) && parsed.length) sites = parsed;
        else sites = initialSites;
      }catch(e){ sites = initialSites; }
    } else {
      sites = initialSites;
    }

    renderTabs();
    renderGrid();
    attachEvents();
    highlightFilteredCount();
  }

  /***********************
   * 렌더링: 탭 + 그리드
   ***********************/
  function renderTabs(){
    document.querySelectorAll('.tab').forEach(btn=>{
      btn.classList.toggle('active', btn.dataset.tab === currentTab);
    });
  }

  function getFilteredSites(){
    const q = document.getElementById('search').value.trim().toLowerCase();
    let arr = sites.slice();
    // tab 필터
    if(currentTab === 'expert'){
      arr = arr.filter(s=>s.expert);
    } else if(currentTab === 'season'){
      // exam season detection simple heuristic: if today is within 45 days of Nov 15 (수능) mark examSeason
      const now = new Date();
      const thisYear = now.getFullYear();
      const suneung = new Date(thisYear,10,14); // 11월 15일(0-indexed month 10) 대략
      const diffDays = Math.abs((suneung - now)/(1000*60*60*24));
      if(diffDays <= 60){
        arr = arr.filter(s=>s.examSeason || s.category==='exam');
      } else {
        // 방학 시즌(7~8월) 추천
        if(now.getMonth()===6 || now.getMonth()===7){
          arr = arr.filter(s=>s.category==='learning' || s.category==='coding');
        } else {
          arr = arr; // default
        }
      }
    } else if(currentTab === 'grade'){
      // 간단 UI: 학년별 버튼으로 필터 (추가 구현 가능). 현재는 전체.
      arr = arr;
    }
    if(q){
      arr = arr.filter(s=>{
        const h = (s.name+' '+(s.desc||'')+' '+(s.guide||'')).toLowerCase();
        return h.includes(q);
      });
    }
    return arr;
  }

  function renderGrid(){
    const container = document.getElementById('grid');
    container.innerHTML = '';
    const list = getFilteredSites();
    if(list.length===0){
      container.innerHTML = `<div style="grid-column:1/-1;padding:24px;border-radius:12px;background:var(--card);text-align:center;color:var(--muted)">조건에 맞는 사이트가 없습니다.</div>`;
      return;
    }

    list.forEach((s, idx) => {
      const card = document.createElement('article');
      card.className = 'card';
      card.draggable = true;
      card.dataset.id = s.id;
      // card inner
      card.innerHTML = `
        <div class="card-actions">
          <button class="icon-btn q" title="미리보기 (P)" data-action="preview">👁</button>
          <button class="icon-btn bookmark" title="가이드 보기" data-action="guide">📘</button>
          <a class="icon-btn" title="새 탭에서 열기" href="${escapeHtml(s.url)}" target="_blank" rel="noopener" data-action="open">↗</a>
        </div>
        <div class="title"><span>${escapeHtml(s.name)}</span> <span style="font-size:12px;color:var(--muted);font-weight:600">· ${escapeHtml(s.category)}</span></div>
        <div class="desc">${escapeHtml(s.desc || s.guide || '')}</div>
        <div class="meta">
          ${ (s.ages || []).map(a=>`<span class="tag">${escapeHtml(a)}</span>`).join(' ') }
          ${ (s.subjects || []).map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join(' ') }
          <span style="margin-left:auto" class="drag-handle" title="드래그로 순서 변경">☰ 순서</span>
        </div>
      `;
      // data
      container.appendChild(card);

      // attach per-card behaviors
      // preview
      card.querySelector('[data-action="preview"]').addEventListener('click', (e)=>{
        openPreview(s);
      });
      // guide
      card.querySelector('[data-action="guide"]').addEventListener('click', (e)=>{
        showGuide(s, card);
      });
      // open (link)
      card.querySelector('[data-action="open"]').addEventListener('click', (e)=>{
        // save recent view
        pushRecent(s);
      });

      // drag events
      addDragHandlers(card);
      // keyboard focus
      card.tabIndex = 0;
      card.addEventListener('focus', ()=>{ focusedIndex = idx; });
    });

    // after render, attempt link health check in background
    setTimeout(()=>{ checkLinksHealth(); }, 600);
  }

  /***********************
   * 가이드 표시 (카드 아래 혹은 모달)
   ***********************/
  function showGuide(site, cardEl){
    // toggle small panel
    let panel = cardEl.querySelector('.guide-box');
    if(panel){
      panel.remove();
      return;
    }
    panel = document.createElement('div');
    panel.className = 'guide-box';
    panel.style.marginTop = '10px';
    panel.innerHTML = `
      <div style="padding:12px;border-radius:10px;border:1px dashed rgba(0,0,0,0.04);background:linear-gradient(180deg,#fafaff,#fff)">
        <strong>활용 가이드</strong>
        <div style="margin-top:8px;color:var(--muted)">${escapeHtml(site.guide || '가이드가 등록되어 있지 않습니다.')}</div>
        <div style="margin-top:8px"><strong>팁</strong>
          <ul style="margin:8px 0 0 18px;color:var(--muted)">${(site.tips||[]).map(t=>`<li>${escapeHtml(t)}</li>`).join('')}</ul>
        </div>
        <div style="margin-top:10px"><strong>사이트 조합 추천</strong>
          <div style="margin-top:6px;color:var(--muted)">${makeComboRecommendation(site)}</div>
        </div>
      </div>
    `;
    cardEl.appendChild(panel);
  }

  function makeComboRecommendation(site){
    // 간단 추천: 같은 과목/연령대에 평판 좋은 다른 사이트 2개
    const sameSubject = sites.filter(s=>{
      if(s.id === site.id) return false;
      const inter = (s.subjects||[]).filter(x=> (site.subjects||[]).includes(x));
      return inter.length>0;
    });
    if(sameSubject.length===0) return '관련 사이트가 더 없습니다.';
    return '예: '+sameSubject.slice(0,2).map(x=>`${x.name}`).join(' / ');
  }

  /***********************
   * 미리보기 모달
   ***********************/
  const previewModal = document.getElementById('previewModal');
  const previewFrame = document.getElementById('previewFrame');
  const modalTitle = document.getElementById('modalTitle');
  document.getElementById('closePreview').addEventListener('click', closePreview);

  function openPreview(site){
    modalTitle.textContent = site.name;
    previewFrame.src = site.url;
    previewModal.classList.add('open');
    previewModal.setAttribute('aria-hidden','false');
  }
  function closePreview(){
    previewFrame.src = 'about:blank';
    previewModal.classList.remove('open');
    previewModal.setAttribute('aria-hidden','true');
  }

  /***********************
   * 링크 상태 확인 (가능하면 HEAD 요청, 실패시 '알 수 없음')
   ***********************/
  async function checkLinksHealth(){
    const cardEls = Array.from(document.querySelectorAll('.card'));
    for(const card of cardEls){
      const hrefEl = card.querySelector('a[data-action="open"]');
      if(!hrefEl) continue;
      const url = hrefEl.href;
      // show spinner
      let s = document.createElement('div'); s.className='spinner'; s.style.width='18px'; s.style.height='18px'; s.style.marginLeft='6px';
      hrefEl.parentElement.appendChild(s);
      try{
        const ok = await fetchWithTimeout(url, {method:'HEAD'}, 3000);
        s.remove();
        const badge = document.createElement('span');
        badge.className = 'tag';
        badge.textContent = ok && ok.ok ? '정상' : '응답없음';
        if(!ok || !ok.ok) badge.style.background='linear-gradient(90deg,#f8d7da,#fbe0e6)';
        card.querySelector('.meta').appendChild(badge);
      }catch(err){
        s.remove();
        const badge = document.createElement('span');
        badge.className = 'tag';
        badge.textContent = '알 수 없음';
        badge.style.background='linear-gradient(90deg,#fff3cd,#fff7e6)';
        card.querySelector('.meta').appendChild(badge);
      }
    }
  }

  function fetchWithTimeout(resource, options = {}, timeout = 5000){
    return new Promise((resolve,reject)=>{
      const timer = setTimeout(()=>reject(new Error('timeout')), timeout);
      fetch(resource, options).then(res=>{
        clearTimeout(timer);
        resolve(res);
      }).catch(err=>{
        clearTimeout(timer);
        reject(err);
      });
    });
  }

  /***********************
   * 드래그앤드롭 정렬 (HTML5 drag)
   ***********************/
  function addDragHandlers(card){
    card.addEventListener('dragstart', (e)=>{
      card.classList.add('dragging');
      e.dataTransfer.setData('text/plain', card.dataset.id);
      e.dataTransfer.effectAllowed = 'move';
    });
    card.addEventListener('dragend', (e)=>{
      card.classList.remove('dragging');
      saveOrderToLocal();
      renderGrid(); // re-render to update indices
    });
    card.addEventListener('dragover', (e)=>{
      e.preventDefault();
      const dragging = document.querySelector('.dragging');
      if(!dragging || dragging === card) return;
      const grid = document.getElementById('grid');
      const rect = card.getBoundingClientRect();
      const after = (e.clientY - rect.top) > rect.height/2;
      if(after) grid.insertBefore(dragging, card.nextSibling);
      else grid.insertBefore(dragging, card);
    });
  }

  function saveOrderToLocal(){
    // get current order from DOM
    const ids = Array.from(document.querySelectorAll('.card')).map(c=>c.dataset.id);
    const newOrder = [];
    ids.forEach(id=>{
      const s = sites.find(x=>x.id===id);
      if(s) newOrder.push(s);
    });
    if(newOrder.length) {
      sites = newOrder;
      localStorage.setItem('dfm_sites_v1', JSON.stringify(sites));
      showToast('정렬이 저장되었습니다.');
    }
  }

  /***********************
   * 최근 본 사이트 (간단 저장)
   ***********************/
  function pushRecent(site){
    try{
      let recent = JSON.parse(localStorage.getItem('dfm_recent_v1')||'[]');
      recent = recent.filter(r=>r.id !== site.id);
      recent.unshift({id:site.id,name:site.name,url:site.url,time:Date.now()});
      recent = recent.slice(0,10);
      localStorage.setItem('dfm_recent_v1', JSON.stringify(recent));
    }catch(e){}
  }

  /***********************
   * 유틸: XSS 방지
   ***********************/
  function escapeHtml(s){ if(!s) return ''; return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

  /***********************
   * 토스트
   ***********************/
  function showToast(msg, err=false){
    const el = document.createElement('div');
    el.textContent = msg;
    el.style.position='fixed'; el.style.right='18px'; el.style.bottom='18px';
    el.style.padding='10px 14px'; el.style.borderRadius='12px'; el.style.background= err? '#dc3545' : 'linear-gradient(90deg,#6c63ff,#7b61ff)';
    el.style.color='#fff'; el.style.boxShadow='0 10px 30px rgba(0,0,0,0.18)'; el.style.zIndex=9999;
    document.body.appendChild(el);
    setTimeout(()=>{ el.style.opacity='0'; setTimeout(()=>el.remove(),400); },2500);
  }

  /***********************
   * 키보드 단축키
   ***********************/
  function attachEvents(){
    // tabs click
    document.querySelectorAll('.tab').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        currentTab = btn.dataset.tab;
        renderTabs();
        renderGrid();
      });
    });
    // search
    document.getElementById('search').addEventListener('input', ()=>{
      renderGrid();
    });
    // theme toggle
    document.getElementById('themeToggle').addEventListener('click', toggleTheme);
    // guide toggle
    document.getElementById('guideToggle').addEventListener('click', ()=>{
      const g = document.getElementById('guideArea');
      const vis = g.getAttribute('aria-hidden') === 'true' ? false : false;
      if(g.style.display === 'none' || g.getAttribute('aria-hidden')==='true'){
        g.style.display='block';
        g.setAttribute('aria-hidden','false');
      } else {
        g.style.display='none';
        g.setAttribute('aria-hidden','true');
      }
    });

    // keyboard
    document.addEventListener('keydown', (e)=>{
      if(e.key === '/') { e.preventDefault(); document.getElementById('search').focus(); }
      if(e.key === 'd' || e.key === 'D'){ toggleTheme(); }
      if(e.key === 'g' || e.key === 'G'){ document.getElementById('guideToggle').click(); }
      if(e.key === 'p' || e.key === 'P'){ // preview focused card
        const focused = document.querySelector('.card:focus') || document.querySelector('.card');
        if(focused){
          const id = focused.dataset.id;
          const site = sites.find(s=>s.id===id);
          if(site) openPreview(site);
        }
      }
      // left/right to change tabs (simple)
      if(e.key === 'ArrowLeft' || e.key === 'ArrowRight'){
        const tabButtons = Array.from(document.querySelectorAll('.tab'));
        const curIdx = tabButtons.findIndex(b=>b.classList.contains('active'));
        let next = curIdx;
        if(e.key === 'ArrowLeft') next = Math.max(0, curIdx-1);
        if(e.key === 'ArrowRight') next = Math.min(tabButtons.length-1, curIdx+1);
        if(tabButtons[next]) tabButtons[next].click();
      }
    });

    // modal close by ESC
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closePreview(); });

    // click outside preview to close
    previewModal.addEventListener('click', (ev)=>{
      if(ev.target === previewModal) closePreview();
    });
  }

  /***********************
   * 테마 저장/토글
   ***********************/
  function toggleTheme(){
    const el = document.body;
    const cur = el.getAttribute('data-theme') || 'light';
    const next = cur === 'light' ? 'dark' : 'light';
    el.setAttribute('data-theme', next);
    localStorage.setItem('dfm_theme_v1', next);
  }
  (function loadTheme(){
    const saved = localStorage.getItem('dfm_theme_v1');
    if(saved) document.body.setAttribute('data-theme', saved);
  })();

  /***********************
   * UI 보조: 필터 결과 카운트
   ***********************/
  function highlightFilteredCount(){
    // small quick info in guide area
    const cnt = getFilteredSites().length;
    document.getElementById('guideSummary').textContent = `현재 ${cnt}개 사이트가 표시됩니다. '/'로 검색, 드래그로 정렬 가능.`;
  }

  // re-highlight after render
  const origRenderGrid = renderGrid;
  renderGrid = function(){ origRenderGrid(); highlightFilteredCount(); };

  // init
  init();
  </script>
</body>
</html>
