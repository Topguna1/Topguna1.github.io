<!DOCTYPE html>
<html lang="ko">
<head>
<script>
(function () {
  // ✅ 렌더링 전에 사용자 설정을 HTML에 선적용해서 FOUC/레이아웃 쉬프트 방지
  const html = document.documentElement;

  // 0) 새로고침 직후 1프레임 동안 애니메이션 OFF (진입 깜빡임 방지)
  html.classList.add('no-anim');
  requestAnimationFrame(() => html.classList.remove('no-anim'));

  function normalize(val, allowed, fallback) {
    return allowed.includes(val) ? val : fallback;
  }

  // 1) localStorage에서 설정 읽기
  let theme = 'system';
  let font  = 'normal';
  let anim  = 'on';
  let radius = 'round';

  try {
    theme  = normalize(localStorage.getItem('siteTheme'),    ['light','dark','system'], 'system');
    font   = normalize(localStorage.getItem('siteFontSize'), ['small','normal','large'], 'normal');
    anim   = normalize(localStorage.getItem('siteAnim'),     ['on','off'], 'on');
    radius = normalize(localStorage.getItem('siteRadius'),   ['square','round'], 'round');
  } catch (e) {
    console.warn('설정 로드 실패:', e);
  }

  // 2) 테마: html 속성은 렌더 전 적용 가능 (body는 뒤에서 동기화)
  try {
    if (theme === 'light' || theme === 'dark') {
      html.setAttribute('data-theme', theme);
      html.dataset.userTheme = '1';
    } else {
      html.removeAttribute('data-theme');
      delete html.dataset.userTheme;
    }
  } catch {}

  // 3) 폰트/애니/모서리: html에 먼저 클래스 부여 (CSS가 body 기반이어도 body에 즉시 동기화)
  html.classList.remove('font-small','font-normal','font-large','anim-off','radius-square','radius-round');
  html.classList.add(`font-${font}`);
  if (anim === 'off') html.classList.add('anim-off');
  html.classList.add(`radius-${radius}`);

  // 4) body가 생기는 즉시 같은 클래스를 복사해서 기존 CSS(body 기반)도 바로 먹게 함
  function syncBodyOnce() {
    const body = document.body;
    if (!body) return false;

    // dark 모드는 기존 구현을 존중 (body.dark)
    const useDark = (theme === 'dark') ||
      (theme === 'system' && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);

    body.classList.toggle('dark', !!useDark);

    body.classList.remove('font-small','font-normal','font-large','anim-off','radius-square','radius-round');
    body.classList.add(`font-${font}`);
    if (anim === 'off') body.classList.add('anim-off');
    body.classList.add(`radius-${radius}`);

    // 토글 버튼 텍스트 동기화
    const btn = document.getElementById('darkToggle');
    if (btn) btn.textContent = useDark ? '☀️ 라이트 모드' : '🌙 다크 모드';

    return true;
  }

  // body가 아직 없으면, 파싱 중에도 최대 60프레임까지만 폴링
  let tries = 0;
  (function waitBody() {
    if (syncBodyOnce()) return;
    if (tries++ > 60) return;
    requestAnimationFrame(waitBody);
  })();

  // system 테마일 때, 기기 설정 변화도 반영 (초기 진입 깜빡임 최소화)
  try {
    if (theme === 'system' && window.matchMedia) {
      const mq = window.matchMedia('(prefers-color-scheme: dark)');
      mq.addEventListener?.('change', () => syncBodyOnce());
    }
  } catch {}
})();
</script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🌟 딱필모 indev </title>
<link rel="stylesheet" href="styles/styles.css">
<link rel="stylesheet" href="about/about.css">
<link rel="stylesheet" href="tips/tips.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">

<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
<script src="js/error-handling.js"></script>
<script src="js/memory-manager.js"></script>  
  <script src="js/utils.js" defer></script>
  <script src="js/ui/scroll.js" defer></script>
  <script src="js/ui/toast.js" defer></script>
  <script src="js/ui/theme.js" defer></script>
  <script src="js/ui/settings.js" defer></script>  
  <script src="js/ui/menu.js" defer></script>
  <script src="js/render.js" defer></script>
  <script src="js/ui/ui-transition.js" defer></script>
  <script src="js/tabs.js" defer></script>
  <script src="about/about.view.js" defer></script>
  <script src="about/about.reveal.js" defer></script>
  <script src="tips/tips.view.js" defer></script>
  <script src="js/main.js" defer></script>
  <script src="tips/tips-routing-patch.js" defer></script>


  <style>
  html.render-freeze *, body.render-freeze * {
    transition: none !important;
    animation: none !important;
  }
  /* [추가] 카드 진입 애니메이션을 담당하는 클래스들이 있을 경우 강제로 숨기거나 멈춤 */
  html.no-card-anim .link-card,
  body.no-card-anim .link-card {
    animation: none !important;
    transition: none !important;
    /* 만약 카드가 등장할 때 opacity fade-in이 있다면 강제로 보이게 설정 */
    opacity: 1 !important; 
    transform: none !important;
  }

</style>
</head>
<body>
  <div class="ui-scale-wrap">
  <div class="container">
    <div class="top-controls">
      <h1 class="top-title">딱필모</h1>
      <div class="search-box">
        <input 
          id="searchInput" 
          placeholder="사이트 이름이나 설명으로 검색하세요"
          autocomplete="off"
        />
        <span class="search-icon">🔍</span>
        <div id="autocomplete-list" class="autocomplete-items"></div>
      </div>
      <p class="top-desc">어떤 사이트를 사용해야 할 지 모르는 당신을 위해서 딱 필요한 사이트 모음</p>
      <details class="top-menu">
        <summary>메뉴</summary>
        <div class="top-menu-panel" role="menu">
          <a href="#/about" class="top-menu-link" role="menuitem">사이트 소개</a>
          <a
            href="https://discord.gg/tvrsCf7b"
            target="_blank"
            rel="noopener noreferrer"
            class="top-menu-link"
            role="menuitem"
          >문의</a>
        </div>
      </details>
      <button class="dark-toggle" id="darkToggle">🌙 다크 모드</button>
    </div>

    <div class="content-layout">
      <aside class="side-panel">
        <div class="side-card">
          <div class="side-card-header">
            <span class="side-card-title">카테고리</span>
          </div>
          <div class="category-tabs">
            <div class="filter-tabs" id="filterTabs"></div>
          </div>
        </div>
        
        <!-- 자료 찾는 팁 섹션 -->
        <div class="side-card" style="margin-top: 16px;">
          <div class="side-card-header">
            <span class="side-card-title">💡 도움말</span>
          </div>
          <div class="tips-section">
            <a href="#/tips" class="tips-link">
              <span class="tips-icon">📚</span>
              <div class="tips-content">
                <span class="tips-title"> 자료 찾는 팁</span>
                <!-- <span class="tips-desc">효과적으로 자료를 검색하는 방법</span> -->
              </div>
              <span class="tips-arrow">→</span>
            </a>
          </div>
        </div>
      </aside>

      <main class="main-panel">
        <div class="filters">
      <div class="filter-group">
        <label>🎯 연령대</label>
        <div class="filter-buttons" id="ageFilter">
          <button class="filter-btn active" data-age="all">전체</button>
          <button class="filter-btn" data-age="elem">초등</button>
          <button class="filter-btn" data-age="mid">중등</button>
          <button class="filter-btn" data-age="high">고등</button>
          <button class="filter-btn" data-age="adult">성인</button>
        </div>
      </div>
      
      <div class="filter-group">
        <label>📚 과목</label>
        <select id="subjectFilter">
          <option value="all">전체 과목</option>
          <option value="korean">국어</option>
          <option value="math">수학</option>
          <option value="english">영어</option>
          <option value="science">과학</option>
          <option value="social">사회</option>
          <option value="history">역사</option>
          <option value="art">예술</option>
          <option value="music">음악</option>
          <option value="pe">체육</option>
          <option value="tech">기술</option>
          <option value="coding">코딩</option>
          <option value="language">외국어</option>
          <option value="general">종합</option>
          <option value="exam">시험대비</option>
          <option value="career">진로</option>
        </select>
      </div>

      <div id="govFilter" class="filter-group">
        <label>🏛️ 정부 운영 선택</label>
        <div class="filter-buttons">
          <button type="button" class="filter-btn active" data-gov="all">전체</button>
          <button type="button" class="filter-btn" data-gov="gov">정부 운영</button>
        </div>
      </div>
      
      <button class="reset-btn" id="resetBtn">🔄 필터 초기화</button>
    </div>
    
    <div class="stats" id="statsBar">
    <!-- 페이지당 보기 -->
    <div class="stats-item">
      <label for="itemsPerPage">📄 페이지당:</label>
      <select id="itemsPerPage">
        <option value="5">5개</option>
        <option value="10" selected>10개</option>
        <option value="20">20개</option>
      </select>
    </div>

    <!-- 페이지 정보 -->
    <div class="stats-item" id="paginationInfo">📄 0개씩 보기 · 0/0 페이지</div>

    <!-- 총 사이트 개수 -->
    <div class="stats-item">
      <span>📊 총</span>
      <strong id="totalCount">0</strong>
      <span>개 사이트</span>
    </div>

    <!-- 검색 결과 개수 -->
    <div class="stats-item">
      <span>🔎 검색 결과:</span>
      <strong id="filteredCount">0</strong>
      <span>개</span>
    </div>

    <!-- 전체 사이트 보기 버튼 -->
    <button class="view-all-btn" id="viewAllBtn">📖 전체 사이트 보기</button>
  </div>
  <!-- 사이트 출력 영역 -->
  <div class="categories-container" id="categoriesContainer"></div>

  <!-- 결과 없음 메시지 -->
  <div id="noResults" class="no-results" style="display:none;">
    <h3>🔍 조건에 맞는 사이트가 없습니다</h3>
    <p>필터나 검색어를 변경해보세요.</p>
  </div>
      </main>
    </div>
  </div>
</div>
<!-- ✅ 상세 뷰 (해시 라우팅) -->
<section id="detailView" class="detail-view" style="display:none;" aria-hidden="true">
  <div class="detail-header">
    <button type="button" id="detailBackBtn" class="detail-back">← 목록</button>

    <div class="detail-title-wrap">
      <img id="detailFavicon" class="detail-favicon" alt="" />
      <h2 id="detailTitle" class="detail-title">사이트 이름</h2>
      <p id="detailDesc" class="detail-desc">설명</p>
    </div>

    <div class="detail-actions">
      <a id="detailGoBtn" class="detail-go" href="#" target="_blank" rel="noopener">바로가기</a>
      <button type="button" id="detailCopyBtn" class="detail-copy">URL 복사</button>
    </div>
  </div>

  <div class="detail-meta" id="detailMeta"></div>

  <h3 class="detail-subtitle">관련 추천</h3>
  <div id="detailRelated" class="detail-related"></div>
</section>
<!-- ✅ 상세 뷰 (해시 라우팅) 끝 -->
<section id="aboutView" class="about-view" style="display:none;" aria-hidden="true"></section>
<!-- Tips View -->
<section id="tipsView" class="tips-view" style="display:none;" aria-hidden="true"></section>

<footer style="
  background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
  color: white;
  text-align: center;
  padding: 40px 20px;
  margin-top: 16px;
  font-size: 14px;
  line-height: 1.8;
">
  <div style="max-width: 800px; margin: 0 auto;">
    <h3 style="margin-bottom: 20px; font-size: 18px;">🌟 딱필모</h3>
    <p style="margin-bottom: 16px;">
      어떤 사이트를 사용해야 할 지 모르는 당신을 위해서 유용한 사이트들을 모았습니다.
    </p>
    <p style="margin-bottom: 24px; font-size: 13px; opacity: 0.8;">
      본 사이트의 소스 코드는 MIT License를 따릅니다.
      <br>
      사이트 데이터 및 큐레이션 콘텐츠는
      Creative Commons BY-NC 4.0 라이선스로 제공됩니다.
      <br>
      모든 외부 링크는 각각의 소유자에게 저작권이 있습니다.
    </p>
    <div style="
      display: flex;
      justify-content: center;
      gap: 24px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    ">
      <span>📊 총 <strong id="footerTotalSites">0</strong>개 사이트</span>
      <span>🎯 <strong id="footerTotalCategories">0</strong>개 카테고리</span>
    </div>
    <div class="footer-info-links" aria-label="사이트 정보 링크">
      <a href="#/about" class="footer-link">소개</a>
      <!--<span class="footer-sep">·</span>

      <a href="#/rules" class="footer-link">이용약관</a>
      <span class="footer-sep">·</span>

      <a href="#/privacy" class="footer-link">개인정보처리방침</a>
      <span class="footer-sep">·</span>

      <a href="#/guide" class="footer-link">이용안내</a>-->
    </div>

    <p class="contact-desc">
      문의는
      <a
        href="https://discord.gg/tvrsCf7b"
        target="_blank"
        rel="noopener noreferrer"
        class="discord-link"
      >
        디스코드
      </a>
      에서 받습니다.
    </p>
  </div>
  <!-- ⚙️ 우측 하단 설정 버튼 & 패널 -->
  <div class="settings-fab" id="settingsFab" aria-label="설정 열기" role="button">
    ⚙️
  </div>
  <div class="scroll-fabs" id="scrollFabs" aria-hidden="true">
    <button type="button" class="scroll-fab" id="scrollTopBtn" aria-label="맨 위로">⬆</button>
    <button type="button" class="scroll-fab" id="scrollBottomBtn" aria-label="맨 아래로">⬇</button>
  </div>
  <div class="settings-backdrop" id="settingsBackdrop" aria-hidden="true"></div>
  <div class="settings-panel" id="settingsPanel" aria-hidden="true">
    <div class="settings-panel-header">
      <span>⚙️ 설정</span>
      <button type="button" class="settings-close" id="settingsCloseBtn">✕</button>
    </div>

    <div class="settings-group">
      <div class="settings-group-title">테마</div>
      <div class="settings-options">
        <button class="settings-pill" data-setting="theme" data-value="light">☀️ 라이트</button>
        <button class="settings-pill" data-setting="theme" data-value="dark">🌙 다크</button>
        <button class="settings-pill" data-setting="theme" data-value="system">🖥️ 기기 설정</button>
      </div>
    </div>

    <div class="settings-group">
      <div class="settings-group-title">글자 크기</div>
      <div class="settings-options">
        <button class="settings-pill" data-setting="font" data-value="small">A-</button>
        <button class="settings-pill" data-setting="font" data-value="normal">A</button>
        <button class="settings-pill" data-setting="font" data-value="large">A+</button>
      </div>
    </div>

    <div class="settings-group">
      <div class="settings-group-title">애니메이션</div>
      <div class="settings-options">
        <button type="button" class="settings-pill" data-setting="anim" data-value="on">✨ 켜짐</button>
        <button type="button" class="settings-pill" data-setting="anim" data-value="off">💤 꺼짐</button>
      </div>
    </div>

    <div class="settings-group">
      <div class="settings-group-title">카드 모서리</div>
      <div class="settings-options">
        <button class="settings-pill" data-setting="radius" data-value="square">▢ 각지게</button>
        <button class="settings-pill" data-setting="radius" data-value="round">◯ 둥글게</button>
      </div>
    </div>

    <div class="settings-actions">
      <button type="button" class="settings-reset" id="settingsResetBtn">
        ↺ 기본값으로 초기화
      </button>
    </div>

  </div>

</footer>
</body>
</html>
