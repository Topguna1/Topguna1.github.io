<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë”± í•„ìš”í•œ ì‚¬ì´íŠ¸ ëª¨ìŒ</title>
<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;
  padding: 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  color: #333;
  transition: all 0.3s ease;
}

body.dark { 
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); 
  color: #fff; 
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  background: rgba(255, 255, 255, 0.95);
  border-radius: 20px;
  backdrop-filter: blur(10px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
  overflow: hidden;
}

body.dark .container {
  background: rgba(26, 26, 46, 0.95);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
}

/* ===== í—¤ë” ===== */
.header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 30px;
  text-align: center;
  position: relative;
  overflow: hidden;
}

.header::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
  animation: floating 6s ease-in-out infinite;
}

@keyframes floating {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
}

.header h1 {
  margin: 0 0 10px 0;
  font-size: 2.5em;
  font-weight: 700;
  position: relative;
  z-index: 1;
}

.header p {
  margin: 0;
  opacity: 0.9;
  font-size: 1.1em;
  position: relative;
  z-index: 1;
}

/* ===== ìƒë‹¨ ì»¨íŠ¸ë¡¤ ===== */
.top-controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 25px 30px;
  background: rgba(248, 249, 250, 0.8);
  border-bottom: 1px solid #e9ecef;
  flex-wrap: wrap;
  gap: 15px;
}

body.dark .top-controls {
  background: rgba(45, 45, 45, 0.8);
  border-bottom-color: #555;
}

.top-buttons {
  display: flex;
  gap: 12px;
  align-items: center;
  flex-wrap: wrap;
}

/* ===== í•„í„° ì˜ì—­ ===== */
.filters {
  padding: 25px 30px;
  background: rgba(248, 249, 250, 0.5);
  border-bottom: 1px solid #e9ecef;
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  align-items: center;
}

body.dark .filters {
  background: rgba(45, 45, 45, 0.5);
  border-bottom-color: #555;
}

.filter-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
  min-width: 120px;
}

.filter-group label {
  font-weight: 600;
  font-size: 14px;
  color: #495057;
}

body.dark .filter-group label {
  color: #adb5bd;
}

select, .filter-buttons {
  padding: 10px 12px;
  border: 2px solid #e9ecef;
  border-radius: 8px;
  background: white;
  font-size: 14px;
  transition: all 0.2s ease;
}

select:focus {
  border-color: #667eea;
  outline: none;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

body.dark select {
  background: #343a40;
  color: #fff;
  border-color: #555;
}

.filter-buttons {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  padding: 6px;
}

.filter-btn {
  padding: 8px 16px;
  border: 2px solid #e9ecef;
  background: white;
  border-radius: 20px;
  cursor: pointer;
  font-size: 13px;
  font-weight: 500;
  white-space: nowrap;
  transition: all 0.2s ease;
}

.filter-btn:hover {
  border-color: #667eea;
  transform: translateY(-1px);
}

.filter-btn.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-color: #667eea;
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

body.dark .filter-btn {
  background: #495057;
  color: #fff;
  border-color: #666;
}

/* ===== ë²„íŠ¼ ìŠ¤íƒ€ì¼ ===== */
button {
  padding: 12px 20px;
  margin: 4px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  font-size: 14px;
  transition: all 0.2s ease;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
}

.admin-btn {
  background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
  color: white;
}

.admin-btn.active {
  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
}

.dark-toggle {
  background: linear-gradient(135deg, #343a40 0%, #212529 100%);
  color: white;
}

.add-btn {
  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
  color: white;
}

.add-category-btn {
  background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
  color: white;
}

/* ===== ì¹´í…Œê³ ë¦¬ ê´€ë¦¬ ===== */
.category-management {
  padding: 20px 30px;
  background: rgba(248, 249, 250, 0.5);
  border-bottom: 1px solid #e9ecef;
}

body.dark .category-management {
  background: rgba(45, 45, 45, 0.5);
  border-bottom-color: #555;
}

.custom-categories {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-top: 10px;
}

.custom-category {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 15px;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border-radius: 20px;
  border: 1px solid #dee2e6;
}

body.dark .custom-category {
  background: linear-gradient(135deg, #495057 0%, #343a40 100%);
  border-color: #666;
}

.remove-category-btn {
  background: #dc3545;
  color: white;
  border: none;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  font-size: 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0;
  padding: 0;
}

/* ===== í†µê³„ ===== */
.stats {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 30px;
  font-size: 14px;
  color: #6c757d;
  background: rgba(248, 249, 250, 0.3);
}

body.dark .stats {
  color: #adb5bd;
  background: rgba(45, 45, 45, 0.3);
}

.stats-item {
  display: flex;
  align-items: center;
  gap: 8px;
}

.stats-number {
  font-weight: 700;
  color: #667eea;
  font-size: 16px;
}

/* ===== ì¹´í…Œê³ ë¦¬/ì¹´ë“œ ===== */
.categories-container {
  padding: 30px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 25px;
}

.category-section {
  background: white;
  border-radius: 15px;
  overflow: hidden;
  border: 1px solid #e9ecef;
  transition: all 0.3s ease;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
}

.category-section:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
}

body.dark .category-section {
  background: #2d2d2d;
  border-color: #555;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.category-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 20px 25px;
  font-size: 18px;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 15px;
}

.category-title {
  display: flex;
  align-items: center;
  gap: 12px;
}

.category-count {
  background: rgba(255, 255, 255, 0.2);
  padding: 4px 12px;
  border-radius: 15px;
  font-size: 14px;
  font-weight: 500;
}

.category-content {
  padding: 25px;
}

.link-card {
  border: 2px solid #f1f3f5;
  border-radius: 12px;
  padding: 20px;
  margin: 15px 0;
  background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
  position: relative;
  transition: all 0.3s ease;
}

.link-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 25px rgba(102, 126, 234, 0.15);
  border-color: #667eea;
}

body.dark .link-card {
  background: linear-gradient(135deg, #343a40 0%, #495057 100%);
  border-color: #555;
}

body.dark .link-card:hover {
  box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
  border-color: #667eea;
}

.link-card a {
  text-decoration: none;
  color: #2c3e50;
  font-weight: 700;
  font-size: 18px;
  display: inline-block;
  margin-bottom: 8px;
  transition: color 0.2s ease;
}

.link-card a:hover {
  color: #667eea;
}

body.dark .link-card a {
  color: #f8f9fa;
}

body.dark .link-card a:hover {
  color: #667eea;
}

.link-card p {
  margin: 10px 0 0 0;
  color: #6c757d;
  line-height: 1.5;
}

body.dark .link-card p {
  color: #adb5bd;
}

.link-meta {
  display: flex;
  gap: 8px;
  margin: 12px 0;
  flex-wrap: wrap;
}

.tag {
  padding: 4px 10px;
  border-radius: 15px;
  font-size: 11px;
  font-weight: 600;
  white-space: nowrap;
}

.age-tag {
  background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
  color: #155724;
}

.category-tag {
  background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
  color: #856404;
}

body.dark .age-tag {
  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
  color: white;
}

body.dark .category-tag {
  background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
  color: #212529;
}

.card-buttons {
  position: absolute;
  top: 15px;
  right: 15px;
  display: flex;
  gap: 6px;
}

.card-btn {
  border: none;
  border-radius: 8px;
  width: 32px;
  height: 32px;
  cursor: pointer;
  font-size: 14px;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0;
  padding: 0;
  transition: all 0.2s ease;
}

.card-btn:hover {
  transform: scale(1.1);
}

.edit-btn {
  background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
}

.delete-btn {
  background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
}

/* ===== ë”ë³´ê¸°/ì ‘ê¸° ë²„íŠ¼ ===== */
.more-btn-container {
  text-align: center;
  margin-top: 20px;
}

.more-btn, .collapse-btn {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  color: #495057;
  border: 2px solid #dee2e6;
  padding: 10px 20px;
  border-radius: 25px;
  font-weight: 600;
  transition: all 0.3s ease;
}

.more-btn:hover, .collapse-btn:hover {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-color: #667eea;
}

body.dark .more-btn, body.dark .collapse-btn {
  background: linear-gradient(135deg, #495057 0%, #343a40 100%);
  color: #f8f9fa;
  border-color: #555;
}

/* ===== ê²°ê³¼ ì—†ìŒ ===== */
.no-results {
  text-align: center;
  color: #6c757d;
  font-style: italic;
  padding: 60px;
  background: rgba(248, 249, 250, 0.5);
  border-radius: 15px;
  margin: 30px;
}

body.dark .no-results {
  color: #adb5bd;
  background: rgba(45, 45, 45, 0.5);
}

/* ===== íŒì—… ===== */
#popup-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1000;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.popup {
  padding: 15px 25px;
  border-radius: 10px;
  color: white;
  font-weight: 600;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  opacity: 0;
  transform: translateX(120%);
  transition: all 0.4s ease;
  backdrop-filter: blur(10px);
}

.popup.show {
  opacity: 1;
  transform: translateX(0);
}

.popup.success {
  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
}

.popup.error {
  background: linear-gradient(135deg, #dc3545 0%, #e74c3c 100%);
}

/* ===== ëª¨ë‹¬ ===== */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 999;
  backdrop-filter: blur(5px);
}

.modal-content {
  background: white;
  padding: 35px;
  border-radius: 20px;
  width: 90%;
  max-width: 600px;
  max-height: 80vh;
  overflow-y: auto;
  position: relative;
  box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
}

body.dark .modal-content {
  background: #2d2d2d;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
  padding-bottom: 15px;
  border-bottom: 2px solid #e9ecef;
}

body.dark .modal-header {
  border-bottom-color: #555;
}

.modal-header h3 {
  margin: 0;
  color: #2c3e50;
  font-size: 24px;
  font-weight: 700;
}

body.dark .modal-header h3 {
  color: #f8f9fa;
}

.close-btn {
  background: linear-gradient(135deg, #dc3545 0%, #c0392b 100%);
  color: white;
  border-radius: 50%;
  width: 35px;
  height: 35px;
  border: none;
  cursor: pointer;
  font-size: 18px;
  margin: 0;
  padding: 0;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: #495057;
}

body.dark .form-group label {
  color: #adb5bd;
}

.form-group input, .form-group textarea, .form-group select {
  width: 100%;
  padding: 12px 15px;
  border: 2px solid #e9ecef;
  border-radius: 8px;
  box-sizing: border-box;
  font-family: inherit;
  font-size: 14px;
  transition: all 0.2s ease;
}

.form-group input:focus, .form-group textarea:focus, .form-group select:focus {
  border-color: #667eea;
  outline: none;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

body.dark .form-group input, body.dark .form-group textarea, body.dark .form-group select {
  background: #343a40;
  color: #fff;
  border-color: #555;
}

.checkbox-group {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-top: 8px;
}

.checkbox-item {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  background: #f8f9fa;
  border-radius: 8px;
  border: 1px solid #e9ecef;
  transition: all 0.2s ease;
}

.checkbox-item:hover {
  background: #e9ecef;
}

body.dark .checkbox-item {
  background: #495057;
  border-color: #666;
  color: #fff;
}

.checkbox-item input {
  width: auto;
  margin: 0;
}

.save-btn {
  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
  color: white;
  padding: 15px 30px;
}

.cancel-btn {
  background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
  color: white;
  padding: 15px 30px;
}

/* ===== ë°ì´í„° ê´€ë¦¬ ===== */
.data-management {
  padding: 25px 30px;
  background: rgba(248, 249, 250, 0.5);
  border-top: 1px solid #e9ecef;
}

body.dark .data-management {
  background: rgba(45, 45, 45, 0.5);
  border-top-color: #555;
}

.data-controls {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  margin-bottom: 15px;
}

.export-btn {
  background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
  color: white;
}

.import-btn {
  background: linear-gradient(135deg, #fd7e14 0%, #e55a4e 100%);
  color: white;
}

.reset-btn {
  background: linear-gradient(135deg, #dc3545 0%, #c0392b 100%);
  color: white;
}

#importFile {
  display: none;
}

/* ===== ë°˜ì‘í˜• ===== */
@media (max-width: 768px) {
  .container {
    margin: 10px;
    border-radius: 15px;
  }
  
  .header h1 {
    font-size: 2em;
  }
  
  .categories-container {
    grid-template-columns: 1fr;
    padding: 20px;
  }
  
  .top-controls, .filters {
    flex-direction: column;
    align-items: stretch;
  }
  
  .filter-group {
    min-width: auto;
  }
}

/* ===== ì• ë‹ˆë©”ì´ì…˜ ===== */
@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.category-section {
  animation: slideInUp 0.6s ease forwards;
}

.category-section:nth-child(2) {
  animation-delay: 0.1s;
}

.category-section:nth-child(3) {
  animation-delay: 0.2s;
}

.category-section:nth-child(4) {
  animation-delay: 0.3s;
}
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>ğŸŒŸ ë”±í•„ëª¨</h1>
    <p>ë”± í•„ìš”í•œ ì‚¬ì´íŠ¸ë§Œ ëª¨ìŒ</p>
  </div>

  <div class="top-controls">
    <div class="stats-item">
      <span>ğŸ“Š</span>
      <span>ì´ <span class="stats-number" id="totalCount">0</span>ê°œ ì‚¬ì´íŠ¸</span>
    </div>
    <div class="top-buttons">
      <button id="adminToggle" class="admin-btn" onclick="toggleAdmin()">ğŸ”’ ê´€ë¦¬ì ë¡œê·¸ì¸</button>
      <button id="addSiteBtn" class="add-btn" onclick="openAddModal()" style="display:none;">â• ìƒˆ ì‚¬ì´íŠ¸ ì¶”ê°€</button>
      <button id="addCategoryBtn" class="add-category-btn" onclick="openAddCategoryModal()" style="display:none;">ğŸ“ ì¹´í…Œê³ ë¦¬ ì¶”ê°€</button>
      <button class="dark-toggle" onclick="toggleDarkMode()">ğŸŒ™ ë‹¤í¬ ëª¨ë“œ</button>
    </div>
  </div>

  <div id="categoryManagement" class="category-management" style="display:none;">
    <h3>ğŸ“ ì‚¬ìš©ì ì •ì˜ ì¹´í…Œê³ ë¦¬</h3>
    <div class="custom-categories" id="customCategories"></div>
  </div>

  <div class="filters">
    <div class="filter-group">
      <label>ğŸ¯ ì—°ë ¹ëŒ€:</label>
      <div class="filter-buttons" id="ageFilter">
        <button class="filter-btn active" data-age="all">ì „ì²´</button>
        <button class="filter-btn" data-age="elem">ì´ˆë“±</button>
        <button class="filter-btn" data-age="mid">ì¤‘ë“±</button>
        <button class="filter-btn" data-age="high">ê³ ë“±</button>
        <button class="filter-btn" data-age="adult">ì„±ì¸</button>
      </div>
    </div>
    <div class="filter-group">
      <label>ğŸ“‚ ì¹´í…Œê³ ë¦¬:</label>
      <div class="filter-buttons" id="categoryFilter">
        <button class="filter-btn active" data-category="all">ì „ì²´</button>
        <button class="filter-btn" data-category="learning">í•™ìŠµ</button>
        <button class="filter-btn" data-category="info">ì •ë³´</button>
        <button class="filter-btn" data-category="government">ì •ë¶€ê¸°ê´€</button>
        <button class="filter-btn" data-category="search">ê²€ìƒ‰ì—”ì§„</button>
        </div>
    </div>
    <div class="filter-group">
      <label>ğŸ“š ê³¼ëª©:</label>
      <select id="subjectFilter">
        <option value="all">ì „ì²´ ê³¼ëª©</option>
        <option value="korean">êµ­ì–´</option>
        <option value="math">ìˆ˜í•™</option>
        <option value="english">ì˜ì–´</option>
        <option value="science">ê³¼í•™</option>
        <option value="social">ì‚¬íšŒ</option>
        <option value="history">ì—­ì‚¬</option>
        <option value="art">ì˜ˆìˆ </option>
        <option value="music">ìŒì•…</option>
        <option value="pe">ì²´ìœ¡</option>
        <option value="tech">ê¸°ìˆ </option>
        <option value="coding">ì½”ë”©</option>
        <option value="language">ì™¸êµ­ì–´</option>
        <option value="general">ì¢…í•©</option>
        <option value="exam">ì‹œí—˜ëŒ€ë¹„</option>
        <option value="career">ì§„ë¡œ</option>
      </select>
    </div>
    <div class="filter-group">
      <button onclick="resetFilters()" style="background:linear-gradient(135deg, #6c757d 0%, #495057 100%);color:white;border:none;padding:12px 16px;border-radius:8px;">ğŸ”„ í•„í„° ì´ˆê¸°í™”</button>
    </div>
  </div>

  <div class="stats">
    <div class="stats-item">
      <span>ğŸ¯</span>
      <span>í•„í„°ë§ëœ ê²°ê³¼: <span class="stats-number" id="filteredCount">0</span>ê°œ</span>
    </div>
    <div class="stats-item">
      <span>ğŸ’¾</span>
      <span id="saveStatus">ë¡œì»¬ ì €ì¥ë¨</span>
    </div>
    <div class="stats-item">
      <span>ğŸŒ</span>
      <button onclick="saveToServer()" style="background:none;border:none;color:inherit;padding:0;margin:0;font-size:inherit;cursor:pointer;">ì„œë²„ ì €ì¥</button>
    </div>
  </div>

  <div class="categories-container" id="categoriesContainer">
    </div>

  <div id="noResults" class="no-results" style="display:none;">
    <h3>ğŸ” ì¡°ê±´ì— ë§ëŠ” ì‚¬ì´íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
    <p>ë‹¤ë¥¸ í•„í„° ì¡°ê±´ì„ ì‹œë„í•´ë³´ì„¸ìš”.</p>
  </div>

  <div id="dataManagement" class="data-management" style="display:none;">
    <h3>ğŸ“Š ë°ì´í„° ê´€ë¦¬</h3>
    <div class="data-controls">
      <button class="export-btn" onclick="exportData()">ğŸ“¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸° (JSON)</button>
      <button class="import-btn" onclick="document.getElementById('importFile').click()">ğŸ“¤ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</button>
      <input type="file" id="importFile" accept=".json" onchange="importData(event)">
      <button class="reset-btn" onclick="resetAllData()">ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”</button>
    </div>
    <p style="font-size: 12px; color: #666; margin: 0;">
      * ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì € ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ìë™ ì €ì¥ë©ë‹ˆë‹¤. ì„œë²„ ì €ì¥ì„ ìœ„í•´ì„œëŠ” ìƒë‹¨ì˜ 'ì„œë²„ ì €ì¥' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
    </p>
  </div>
</div>

<div id="popup-container"></div>

<div class="modal-overlay" id="siteModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="siteModalTitle">ìƒˆ ì‚¬ì´íŠ¸ ì¶”ê°€</h3>
      <button class="close-btn" onclick="closeSiteModal()">âœ•</button>
    </div>
    <form id="siteForm" onsubmit="saveSite(event)">
      <div class="form-group">
        <label for="siteName">ì‚¬ì´íŠ¸ ì´ë¦„ *</label>
        <input type="text" id="siteName" required>
      </div>
      <div class="form-group">
        <label for="siteUrl">URL *</label>
        <input type="url" id="siteUrl" required placeholder="https://example.com">
      </div>
      <div class="form-group">
        <label for="siteDesc">ì„¤ëª…</label>
        <textarea id="siteDesc" rows="3" placeholder="ì‚¬ì´íŠ¸ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…"></textarea>
      </div>
      <div class="form-group">
        <label for="siteCategory">ì¹´í…Œê³ ë¦¬ *</label>
        <select id="siteCategory" required>
          <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
          <option value="learning">í•™ìŠµ</option>
          <option value="info">ì •ë³´</option>
          <option value="government">ì •ë¶€ê¸°ê´€</option>
          <option value="search">ê²€ìƒ‰ì—”ì§„</option>
          </select>
      </div>
      <div class="form-group">
        <label>ì—°ë ¹ëŒ€ * (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</label>
        <div class="checkbox-group" id="ageCheckboxes">
          <div class="checkbox-item"><input type="checkbox" id="age-elem" value="elem"><label for="age-elem">ì´ˆë“±í•™ìƒ</label></div>
          <div class="checkbox-item"><input type="checkbox" id="age-mid" value="mid"><label for="age-mid">ì¤‘í•™ìƒ</label></div>
          <div class="checkbox-item"><input type="checkbox" id="age-high" value="high"><label for="age-high">ê³ ë“±í•™ìƒ</label></div>
          <div class="checkbox-item"><input type="checkbox" id="age-adult" value="adult"><label for="age-adult">ì„±ì¸</label></div>
        </div>
      </div>
      <div class="form-group">
        <label>ê³¼ëª© (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</label>
        <div class="checkbox-group" id="subjectCheckboxes">
          <div class="checkbox-item"><input type="checkbox" id="subj-korean" value="korean"><label for="subj-korean">êµ­ì–´</label></div>
          <div class="checkbox-item"><input type="checkbox" id="subj-math" value="math"><label for="subj-math">ìˆ˜í•™</label></div>
          <div class="checkbox-item"><input type="checkbox" id="subj-english" value="english"><label for="subj-english">ì˜ì–´</label></div>
          <div class="checkbox-item"><input type="checkbox" id="subj-science" value="science"><label for="subj-science">ê³¼í•™</label></div>
          <div class="checkbox-item"><input type="checkbox" id="subj-social" value="social"><label for="subj-social">ì‚¬íšŒ</label></div>
          <div class="checkbox-item"><input type="checkbox" id="subj-history" value="history"><label for="subj-history">ì—­ì‚¬</label></div>
          <div class="checkbox-item"><input type="checkbox" id="subj-art" value="art"><label for="subj-art">ì˜ˆìˆ </label></div>
          <div class="checkbox-item"><input type="checkbox" id="subj-music" value="music"><label for="subj-music">ìŒì•…</label></div>
          <div class="checkbox-item"><input type="checkbox" id="subj-pe" value="pe"><label for="subj-pe">ì²´ìœ¡</label></div>
          <div class="checkbox-item"><input type="checkbox" id="subj-tech" value="tech"><label for="subj-tech">ê¸°ìˆ </label></div>
          <div class="checkbox-item"><input type="checkbox" id="subj-coding" value="coding"><label for="subj-coding">ì½”ë”©</label></div>
          <div class="checkbox-item"><input type="checkbox" id="subj-language" value="language"><label for="subj-language">ì™¸êµ­ì–´</label></div>
          <div class="checkbox-item"><input type="checkbox" id="subj-general" value="general"><label for="subj-general">ì¢…í•©</label></div>
          <div class="checkbox-item"><input type="checkbox" id="subj-exam" value="exam"><label for="subj-exam">ì‹œí—˜ëŒ€ë¹„</label></div>
          <div class="checkbox-item"><input type="checkbox" id="subj-career" value="career"><label for="subj-career">ì§„ë¡œ</label></div>
        </div>
      </div>
      <div style="text-align: right; margin-top: 20px;">
        <button type="button" class="cancel-btn" onclick="closeSiteModal()">ì·¨ì†Œ</button>
        <button type="submit" class="save-btn">ì €ì¥</button>
      </div>
    </form>
  </div>
</div>

<div class="modal-overlay" id="categoryModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€</h3>
      <button class="close-btn" onclick="closeCategoryModal()">âœ•</button>
    </div>
    <form id="categoryForm" onsubmit="saveCategory(event)">
      <div class="form-group">
        <label for="categoryName">ì¹´í…Œê³ ë¦¬ ì´ë¦„ *</label>
        <input type="text" id="categoryName" required placeholder="ì˜ˆ: ê³¼í•™ì‹¤í—˜">
      </div>
      <div class="form-group">
        <label for="categoryIcon">ì•„ì´ì½˜ *</label>
        <input type="text" id="categoryIcon" required placeholder="ì˜ˆ: ğŸ§ª" maxlength="2">
      </div>
      <div class="form-group">
        <label for="categoryKey">ì¹´í…Œê³ ë¦¬ í‚¤ *</label>
        <input type="text" id="categoryKey" required placeholder="ì˜ˆ: science_lab" pattern="[a-z_]+" title="ì†Œë¬¸ìì™€ ì–¸ë”ìŠ¤ì½”ì–´ë§Œ ì‚¬ìš© ê°€ëŠ¥">
        <small style="color: #666;">ì†Œë¬¸ìì™€ ì–¸ë”ìŠ¤ì½”ì–´(_)ë§Œ ì‚¬ìš©í•˜ì„¸ìš”</small>
      </div>
      <div style="text-align: right; margin-top: 20px;">
        <button type="button" class="cancel-btn" onclick="closeCategoryModal()">ì·¨ì†Œ</button>
        <button type="submit" class="save-btn">ì¶”ê°€</button>
      </div>
    </form>
  </div>
</div>

<script>
// ìƒìˆ˜ ì •ì˜
const ageNames = {elem:"ì´ˆë“±í•™ìƒ",mid:"ì¤‘í•™ìƒ",high:"ê³ ë“±í•™ìƒ",adult:"ì„±ì¸"};
const subjectNames = {korean:"êµ­ì–´",math:"ìˆ˜í•™",english:"ì˜ì–´",science:"ê³¼í•™",social:"ì‚¬íšŒ",history:"ì—­ì‚¬",art:"ì˜ˆìˆ ",music:"ìŒì•…",pe:"ì²´ìœ¡",tech:"ê¸°ìˆ ",coding:"ì½”ë”©",language:"ì™¸êµ­ì–´",general:"ì¢…í•©",exam:"ì‹œí—˜ëŒ€ë¹„",career:"ì§„ë¡œ"};

// âœ… ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ ì •ì˜ ('gpt' ì¶”ê°€)
const defaultCategories = {
  learning: {name: "í•™ìŠµ ì‚¬ì´íŠ¸", icon: "ğŸ“–"},
  info: {name: "ì •ë³´ ì‚¬ì´íŠ¸", icon: "ğŸ“‹"},
  government: {name: "ì •ë¶€ê¸°ê´€", icon: "ğŸ›ï¸"},
  search: {name: "ê²€ìƒ‰ ì—”ì§„", icon: "ğŸ”"},
  gpt: {name: "GPT í™œìš©", icon: "ğŸ¤–"} // âœ¨ ì‹ ê·œ ì¹´í…Œê³ ë¦¬
};

// ì „ì—­ ë³€ìˆ˜
let sites = [];
let customCategories = {};
let categoryDisplayLimits = {};
let expandedCategories = {};

let currentAgeFilter = "all";
let currentCategoryFilter = "all";
let currentSubjectFilter = "all";
let editingIndex = -1;
let isAdminLoggedIn = false;

// âœ… ì´ˆê¸° ë°ì´í„° (ì‹ ê·œ ì‚¬ì´íŠ¸ 8ê°œ ì¶”ê°€)
const initialSites = [
  // í•™ìŠµ ì‚¬ì´íŠ¸
  {name:"EBS ì´ˆë“±",url:"https://www.ebs.co.kr/course/home?courseType=ELMT",desc:"ì´ˆë“± ì „ ê³¼ëª© ì˜¨ë¼ì¸ ê°•ì˜",category:"learning",ages:["elem"],subjects:["korean","math","science","social"]},
  {name:"Khan Academy",url:"https://ko.khanacademy.org/",desc:"ìˆ˜í•™, ê³¼í•™ ë¬´ë£Œ ê°•ì˜",category:"learning",ages:["elem","mid","high","adult"],subjects:["math","science"]},
  {name:"Code.org",url:"https://code.org",desc:"ì´ˆë“±~ê³ ë“± ì½”ë”© í•™ìŠµ",category:"learning",ages:["elem","mid","high"],subjects:["coding"]},
  {name:"Duolingo",url:"https://www.duolingo.com/",desc:"ì™¸êµ­ì–´ í•™ìŠµ ê²Œì„í˜• í”Œë«í¼",category:"learning",ages:["elem","mid","high","adult"],subjects:["language","english"]},
  {name:"Coursera",url:"https://www.coursera.org/",desc:"ì „ ì„¸ê³„ ëŒ€í•™ ë° ê¸°ì—…ì˜ ì˜¨ë¼ì¸ ê°•ì¢Œ",category:"learning",ages:["high","adult"],subjects:["general","language"]}, // âœ¨ ì¶”ê°€
  
  // ì •ë³´ ì‚¬ì´íŠ¸
  {name:"ìœ„í‚¤ë°±ê³¼",url:"https://ko.wikipedia.org/",desc:"ììœ  ë°±ê³¼ì‚¬ì „",category:"info",ages:["mid","high","adult"],subjects:["general"]},
  {name:"êµ­ë¦½ì¤‘ì•™ê³¼í•™ê´€",url:"https://www.science.go.kr/",desc:"ê³¼í•™ ì²´í—˜ ë° êµìœ¡ ì •ë³´",category:"info",ages:["elem","mid","high"],subjects:["science"]},
  {name:"ë‚˜ë¬´ìœ„í‚¤",url:"https://namu.wiki/",desc:"ë‹¤ì–‘í•œ ì£¼ì œë¥¼ ë‹¤ë£¨ëŠ” í•œêµ­ì–´ ìœ„í‚¤",category:"info",ages:["mid","high","adult"],subjects:["general"]}, // âœ¨ ì¶”ê°€

  // ì •ë¶€ê¸°ê´€
  {name:"êµìœ¡ë¶€",url:"https://www.moe.go.kr/",desc:"ëŒ€í•œë¯¼êµ­ êµìœ¡ë¶€ ê³µì‹ ì‚¬ì´íŠ¸",category:"government",ages:["adult"],subjects:["general"]},
  {name:"í•œêµ­êµìœ¡ê³¼ì •í‰ê°€ì›",url:"https://www.kice.re.kr/",desc:"êµìœ¡ê³¼ì • ë° í‰ê°€ ì •ë³´",category:"government",ages:["mid","high","adult"],subjects:["general","exam"]},
  {name:"í•œêµ­êµìœ¡í•™ìˆ ì •ë³´ì›",url:"https://www.keris.or.kr/",desc:"êµìœ¡ ì •ë³´í™” ë° í•™ìˆ  ì •ë³´",category:"government",ages:["high","adult"],subjects:["general"]},
  {name:"êµ­ë¯¼ì‹ ë¬¸ê³ ",url:"https://www.epeople.go.kr/",desc:"ì •ë¶€ì— ì •ì±… ë° ë¯¼ì›ì„ ì œì•ˆí•˜ëŠ” ì˜¨ë¼ì¸ ì†Œí†µ ì°½êµ¬",category:"government",ages:["adult"],subjects:["general","social"]}, // âœ¨ ì¶”ê°€

  // ê²€ìƒ‰ ì—”ì§„
  {name:"ë„¤ì´ë²„",url:"https://www.naver.com/",desc:"ëŒ€í•œë¯¼êµ­ ëŒ€í‘œ í¬í„¸ì‚¬ì´íŠ¸",category:"search",ages:["elem","mid","high","adult"],subjects:["general"]},
  {name:"êµ¬ê¸€",url:"https://www.google.com/",desc:"ì„¸ê³„ ìµœëŒ€ ê²€ìƒ‰ì—”ì§„",category:"search",ages:["elem","mid","high","adult"],subjects:["general"]},
  {name:"DuckDuckGo",url:"https://duckduckgo.com/",desc:"ê°œì¸ì •ë³´ ë³´í˜¸ì— ì¤‘ì ì„ ë‘” ê²€ìƒ‰ ì—”ì§„",category:"search",ages:["mid","high","adult"],subjects:["general"]}, // âœ¨ ì¶”ê°€

  // GPT í™œìš©
  {name:"ChatGPT", url:"https://chat.openai.com/", desc:"OpenAIì—ì„œ ê°œë°œí•œ ëŒ€í™”í˜• ì¸ê³µì§€ëŠ¥ ëª¨ë¸", category:"gpt", ages:["mid", "high", "adult"], subjects:["general", "coding"]}, // âœ¨ ì¶”ê°€
  {name:"Poe by Quora", url:"https://poe.com/", desc:"ë‹¤ì–‘í•œ AI ì±—ë´‡ì„ í•œê³³ì—ì„œ ê²½í—˜í•  ìˆ˜ ìˆëŠ” í”Œë«í¼", category:"gpt", ages:["high", "adult"], subjects:["general"]}, // âœ¨ ì¶”ê°€
  {name:"DeepL", url:"https://www.deepl.com/translator", desc:"AI ê¸°ë°˜ì˜ ê³ í’ˆì§ˆ ë²ˆì—­ ì„œë¹„ìŠ¤", category:"gpt", ages:["mid", "high", "adult"], subjects:["language"]}, // âœ¨ ì¶”ê°€
  {name:"Gamma", url:"https://gamma.app/", desc:"AIë¥¼ í™œìš©í•˜ì—¬ í”„ë ˆì  í…Œì´ì…˜, ë¬¸ì„œë¥¼ ë¹ ë¥´ê²Œ ì œì‘", category:"gpt", ages:["high", "adult"], subjects:["tech", "art"]} // âœ¨ ì¶”ê°€
];

// ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
function getAllCategories() {
  return {...defaultCategories, ...customCategories};
}

function getCategoryName(key) {
  const allCategories = getAllCategories();
  return allCategories[key] ? allCategories[key].name : key;
}

function getCategoryIcon(key) {
  const allCategories = getAllCategories();
  return allCategories[key] ? allCategories[key].icon : "ğŸ“";
}

// ì´ˆê¸° ì¹´í…Œê³ ë¦¬ í‘œì‹œ ì œí•œ ì„¤ì •
function initializeDisplayLimits() {
  const allCategoryKeys = Object.keys(getAllCategories());
  allCategoryKeys.forEach(category => {
    if (!categoryDisplayLimits[category]) {
      categoryDisplayLimits[category] = 3;
    }
  });
}

// ë°ì´í„° ì €ì¥/ë¡œë“œ
function saveData() {
  try {
    const data = {
      sites: sites,
      customCategories: customCategories,
      categoryDisplayLimits: categoryDisplayLimits,
      version: "2.0"
    };
    window.savedSitesData = JSON.stringify(data);
    updateSaveStatus('ë¡œì»¬ ì €ì¥ë¨');
    return true;
  } catch (error) {
    console.error('ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', error);
    return false;
  }
}

function loadData() {
  try {
    if (window.savedSitesData) {
      const data = JSON.parse(window.savedSitesData);
      if (data.sites && Array.isArray(data.sites)) {
        sites = data.sites;
      }
      if (data.customCategories) {
        customCategories = data.customCategories;
      }
      if (data.categoryDisplayLimits) {
        categoryDisplayLimits = data.categoryDisplayLimits;
      }
      return true;
    }
    return false;
  } catch (error) {
    console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
    return false;
  }
}

// ì„œë²„ ì €ì¥ ì‹œë®¬ë ˆì´ì…˜
function saveToServer() {
  if (!isAdminLoggedIn) {
    if (!checkAdminAuth()) return;
  }
  
  updateSaveStatus('ì„œë²„ ì €ì¥ ì¤‘...');
  
  setTimeout(() => {
    if (Math.random() > 0.1) {
      updateSaveStatus('ì„œë²„ ì €ì¥ ì™„ë£Œ âœ“');
      showPopup('ì„œë²„ì— ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
    } else {
      updateSaveStatus('ì„œë²„ ì €ì¥ ì‹¤íŒ¨ âœ—');
      showPopup('ì„œë²„ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', true);
    }
  }, 2000);
}

function updateSaveStatus(status) {
  document.getElementById('saveStatus').textContent = status;
}

// íŒì—… ì•Œë¦¼
function showPopup(message, isError = false) {
  const container = document.getElementById("popup-container");
  const popup = document.createElement("div");
  popup.className = `popup ${isError ? 'error' : 'success'}`;
  popup.textContent = message;
  container.appendChild(popup);
  setTimeout(() => popup.classList.add("show"), 10);
  setTimeout(() => {
    popup.classList.remove("show");
    popup.addEventListener('transitionend', () => popup.remove());
  }, 3000);
}

// ê´€ë¦¬ì ê¸°ëŠ¥
function toggleAdmin() {
  if (isAdminLoggedIn) {
    logout();
  } else {
    checkAdminAuth();
  }
}

function checkAdminAuth() {
  const password = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
  if (password === "admin123") {
    isAdminLoggedIn = true;
    showPopup("ê´€ë¦¬ì ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤!");
    updateAdminUI();
    return true;
  } else if (password !== null) {
    showPopup("ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.", true);
  }
  return false;
}

function logout() {
  isAdminLoggedIn = false;
  showPopup("ê´€ë¦¬ì ëª¨ë“œê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
  updateAdminUI();
}

function updateAdminUI() {
  const adminToggle = document.getElementById('adminToggle');
  const addBtn = document.getElementById('addSiteBtn');
  const addCategoryBtn = document.getElementById('addCategoryBtn');
  const categoryManagement = document.getElementById('categoryManagement');
  const dataManagement = document.getElementById('dataManagement');
  
  if (isAdminLoggedIn) {
    adminToggle.textContent = 'ğŸ”“ ê´€ë¦¬ì ëª¨ë“œ (ë¡œê·¸ì•„ì›ƒ)';
    adminToggle.className = 'admin-btn active';
    addBtn.style.display = 'inline-flex';
    addCategoryBtn.style.display = 'inline-flex';
    categoryManagement.style.display = 'block';
    dataManagement.style.display = 'block';
  } else {
    adminToggle.textContent = 'ğŸ”’ ê´€ë¦¬ì ë¡œê·¸ì¸';
    adminToggle.className = 'admin-btn';
    addBtn.style.display = 'none';
    addCategoryBtn.style.display = 'none';
    categoryManagement.style.display = 'none';
    dataManagement.style.display = 'none';
  }
  
  renderCustomCategories();
  renderSites();
}

// í†µê³„ ì—…ë°ì´íŠ¸
function updateStats() {
  document.getElementById("totalCount").textContent = sites.length;
  document.getElementById("filteredCount").textContent = getFilteredSites().length;
}

// í•„í„°ë§ëœ ì‚¬ì´íŠ¸ ê°€ì ¸ì˜¤ê¸°
function getFilteredSites() {
  return sites.filter(s =>
    (currentAgeFilter === "all" || s.ages.includes(currentAgeFilter)) &&
    (currentCategoryFilter === "all" || s.category === currentCategoryFilter) &&
    (currentSubjectFilter === "all" || s.subjects.includes(currentSubjectFilter))
  );
}

// ì¹´í…Œê³ ë¦¬ ì„¹ì…˜ ìƒì„±
function createCategorySection(categoryKey) {
  const allCategories = getAllCategories();
  const categoryInfo = allCategories[categoryKey];
  if (!categoryInfo) return null;

  const section = document.createElement('div');
  section.className = 'category-section';
  section.id = `${categoryKey}-section`;
  
  section.innerHTML = `
    <div class="category-header">
      <div class="category-title">
        <span>${categoryInfo.icon}</span>
        <span>${categoryInfo.name}</span>
      </div>
      <div class="category-count" id="${categoryKey}-count">0</div>
    </div>
    <div class="category-content" id="${categoryKey}-content"></div>
  `;
  
  return section;
}

// ëª¨ë“  ì¹´í…Œê³ ë¦¬ ì„¹ì…˜ ë Œë”ë§
function renderCategorySections() {
  const container = document.getElementById('categoriesContainer');
  container.innerHTML = '';
  
  const allCategoryKeys = Object.keys(getAllCategories());
  
  allCategoryKeys.forEach(categoryKey => {
    const section = createCategorySection(categoryKey);
    if (section) {
      container.appendChild(section);
    }
  });
}

// ì‚¬ì´íŠ¸ ì¹´ë“œ ìƒì„±
function createSiteCard(site, index) {
  const card = document.createElement("div");
  card.className = "link-card";
  
  const ageTags = site.ages.map(a => `<span class="tag age-tag">${ageNames[a]}</span>`).join(" ");
  const categoryTag = `<span class="tag category-tag">${getCategoryName(site.category)}</span>`;
  
  const adminButtons = isAdminLoggedIn ? `
    <div class="card-buttons">
      <button class="card-btn edit-btn" onclick="openEditModal(${index})" title="ìˆ˜ì •">âœï¸</button>
      <button class="card-btn delete-btn" onclick="deleteSite(${index})" title="ì‚­ì œ">ğŸ—‘ï¸</button>
    </div>
  ` : '';
  
  card.innerHTML = `
    ${adminButtons}
    <a href="${site.url}" target="_blank">${site.name}</a>
    <div class="link-meta">${categoryTag} ${ageTags}</div>
    <p>${site.desc || 'ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.'}</p>
  `;
  return card;
}

// ì‚¬ì´íŠ¸ ë Œë”ë§
function renderSites() {
  const allCategoryKeys = Object.keys(getAllCategories());
  const allFilteredSites = getFilteredSites();
  let hasResults = allFilteredSites.length > 0;

  allCategoryKeys.forEach(category => {
    const container = document.getElementById(`${category}-content`);
    const section = document.getElementById(`${category}-section`);
    const countElement = document.getElementById(`${category}-count`);
    
    if (!container || !section) return;

    const sitesInCategory = allFilteredSites.filter(s => s.category === category);
    container.innerHTML = "";
    
    if (countElement) {
      countElement.textContent = sitesInCategory.length;
    }
    
    if (sitesInCategory.length > 0) {
      section.style.display = "block";
      
      const limit = categoryDisplayLimits[category] || 3;
      const isExpanded = expandedCategories[category];
      const sitesToShow = isExpanded ? sitesInCategory : sitesInCategory.slice(0, limit);
      const remainingSites = sitesInCategory.length - limit;
      
      sitesToShow.forEach(site => {
        const idx = sites.indexOf(site);
        container.appendChild(createSiteCard(site, idx));
      });
      
      if (sitesInCategory.length > limit) {
        const btnContainer = document.createElement("div");
        btnContainer.className = "more-btn-container";
        
        if (isExpanded) {
          btnContainer.innerHTML = `
            <button class="collapse-btn" onclick="collapseSites('${category}')">
              ì ‘ê¸° â†‘
            </button>
          `;
        } else {
          btnContainer.innerHTML = `
            <button class="more-btn" onclick="expandSites('${category}')">
              ë”ë³´ê¸° (${remainingSites}ê°œ ë” ìˆìŒ) â†“
            </button>
          `;
        }
        container.appendChild(btnContainer);
      }
      
    } else if (currentCategoryFilter === "all" || currentCategoryFilter === category) {
      section.style.display = "block";
      container.innerHTML = "<p style='color:#666;text-align:center;padding:20px;'>í•´ë‹¹ ì¡°ê±´ì˜ ì‚¬ì´íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
    } else {
      section.style.display = "none";
    }
  });

  document.getElementById("noResults").style.display = hasResults ? "none" : "block";
  updateStats();
}

// ë”ë³´ê¸°/ì ‘ê¸° ê¸°ëŠ¥
function expandSites(category) {
  expandedCategories[category] = true;
  renderSites();
}

function collapseSites(category) {
  expandedCategories[category] = false;
  renderSites();
}

// ì‚¬ìš©ì ì •ì˜ ì¹´í…Œê³ ë¦¬ ë Œë”ë§
function renderCustomCategories() {
  const container = document.getElementById('customCategories');
  container.innerHTML = '';
  
  Object.entries(customCategories).forEach(([key, categoryInfo]) => {
    const categoryDiv = document.createElement('div');
    categoryDiv.className = 'custom-category';
    categoryDiv.innerHTML = `
      <span>${categoryInfo.icon}</span>
      <span>${categoryInfo.name}</span>
      ${isAdminLoggedIn ? `<button class="remove-category-btn" onclick="removeCategory('${key}')" title="ì‚­ì œ">âœ•</button>` : ''}
    `;
    container.appendChild(categoryDiv);
  });
  
  updateCategoryFilter(); // ì´ í•¨ìˆ˜ê°€ ëª¨ë“  ì¹´í…Œê³ ë¦¬ë¥¼ í•„í„°ì— ë°˜ì˜
}

// ì¹´í…Œê³ ë¦¬ í•„í„° ì—…ë°ì´íŠ¸
function updateCategoryFilter() {
    const filterContainer = document.getElementById('categoryFilter');
    filterContainer.innerHTML = '<button class="filter-btn active" data-category="all">ì „ì²´</button>'; // ì´ˆê¸°í™”
    
    const allCategories = getAllCategories();

    Object.entries(allCategories).forEach(([key, categoryInfo]) => {
        const button = document.createElement('button');
        button.className = 'filter-btn';
        button.dataset.category = key;
        button.textContent = categoryInfo.name;
        filterContainer.appendChild(button);
    });

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ì„¤ì •
    filterContainer.querySelectorAll(".filter-btn").forEach(btn =>
        btn.addEventListener("click", e => {
            filterContainer.querySelector(".active").classList.remove("active");
            e.target.classList.add("active");
            currentCategoryFilter = e.target.dataset.category;
            expandedCategories = {};
            renderSites();
        })
    );
    
    updateSiteFormCategories();
}

// ì‚¬ì´íŠ¸ í¼ ì¹´í…Œê³ ë¦¬ ì„ íƒ ì—…ë°ì´íŠ¸
function updateSiteFormCategories() {
    const select = document.getElementById('siteCategory');
    if (!select) return;
    
    const currentValue = select.value;
    select.innerHTML = '<option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>'; // ì´ˆê¸°í™”

    const allCategories = getAllCategories();
    Object.entries(allCategories).forEach(([key, categoryInfo]) => {
        const option = document.createElement('option');
        option.value = key;
        option.textContent = categoryInfo.name;
        select.appendChild(option);
    });
    select.value = currentValue;
}

// í•„í„° ì„¤ì •
function setupFilters() {
  document.querySelectorAll("#ageFilter .filter-btn").forEach(btn =>
    btn.addEventListener("click", e => {
      document.querySelector("#ageFilter .active").classList.remove("active");
      e.target.classList.add("active");
      currentAgeFilter = e.target.dataset.age;
      renderSites();
    })
  );

  // ì¹´í…Œê³ ë¦¬ í•„í„°ëŠ” renderCustomCategoriesì—ì„œ ë™ì ìœ¼ë¡œ ì„¤ì •ë˜ë¯€ë¡œ ì´ˆê¸° ì„¤ì •ì€ ì—¬ê¸°ì„œ ì œì™¸
  
  document.getElementById("subjectFilter").addEventListener("change", e => {
    currentSubjectFilter = e.target.value;
    renderSites();
  });
}

// í•„í„° ì´ˆê¸°í™”
function resetFilters() {
  currentAgeFilter = "all";
  currentCategoryFilter = "all";
  currentSubjectFilter = "all";
  document.querySelector("#ageFilter .filter-btn[data-age='all']").click();
  document.querySelector("#categoryFilter .filter-btn[data-category='all']").click();
  document.getElementById("subjectFilter").value = "all";
  expandedCategories = {};
  renderSites();
}

// ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
function openAddModal() {
  if (!isAdminLoggedIn && !checkAdminAuth()) return;
  editingIndex = -1;
  document.getElementById("siteModalTitle").textContent = "ìƒˆ ì‚¬ì´íŠ¸ ì¶”ê°€";
  document.getElementById("siteForm").reset();
  clearFormCheckboxes();
  document.getElementById("siteModal").style.display = "flex";
}

function openEditModal(index) {
  if (!isAdminLoggedIn && !checkAdminAuth()) return;
  editingIndex = index;
  const site = sites[index];
  document.getElementById("siteModalTitle").textContent = "ì‚¬ì´íŠ¸ ìˆ˜ì •";
  
  document.getElementById("siteName").value = site.name;
  document.getElementById("siteUrl").value = site.url;
  document.getElementById("siteDesc").value = site.desc || "";
  document.getElementById("siteCategory").value = site.category;
  
  clearFormCheckboxes();
  
  site.ages.forEach(age => {
    const checkbox = document.getElementById(`age-${age}`);
    if (checkbox) checkbox.checked = true;
  });
  
  site.subjects.forEach(subject => {
    const checkbox = document.getElementById(`subj-${subject}`);
    if (checkbox) checkbox.checked = true;
  });
  
  document.getElementById("siteModal").style.display = "flex";
}

function closeSiteModal() {
  document.getElementById("siteModal").style.display = "none";
  document.getElementById("siteForm").reset();
  clearFormCheckboxes();
}

function clearFormCheckboxes() {
  document.querySelectorAll('#ageCheckboxes input[type="checkbox"]').forEach(cb => cb.checked = false);
  document.querySelectorAll('#subjectCheckboxes input[type="checkbox"]').forEach(cb => cb.checked = false);
}

function openAddCategoryModal() {
  if (!isAdminLoggedIn && !checkAdminAuth()) return;
  document.getElementById("categoryForm").reset();
  document.getElementById("categoryModal").style.display = "flex";
}

function closeCategoryModal() {
  document.getElementById("categoryModal").style.display = "none";
  document.getElementById("categoryForm").reset();
}

// ì¹´í…Œê³ ë¦¬ ì €ì¥
function saveCategory(event) {
  event.preventDefault();
  
  const name = document.getElementById("categoryName").value.trim();
  const icon = document.getElementById("categoryIcon").value.trim();
  const key = document.getElementById("categoryKey").value.trim().toLowerCase();
  
  if (!name || !icon || !key) {
    showPopup("ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.", true);
    return;
  }
  
  if (!/^[a-z_]+$/.test(key)) {
    showPopup("ì¹´í…Œê³ ë¦¬ í‚¤ëŠ” ì†Œë¬¸ìì™€ ì–¸ë”ìŠ¤ì½”ì–´(_)ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.", true);
    return;
  }
  
  if (defaultCategories[key] || customCategories[key]) {
    showPopup("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì¹´í…Œê³ ë¦¬ í‚¤ì…ë‹ˆë‹¤.", true);
    return;
  }
  
  customCategories[key] = {name: name, icon: icon};
  categoryDisplayLimits[key] = 3;
  
  saveData();
  renderCategorySections();
  renderCustomCategories();
  renderSites();
  closeCategoryModal();
  showPopup(`'${name}' ì¹´í…Œê³ ë¦¬ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`);
}

// ì¹´í…Œê³ ë¦¬ ì‚­ì œ
function removeCategory(key) {
  if (!isAdminLoggedIn && !checkAdminAuth()) return;
  
  const categoryInfo = customCategories[key];
  const sitesInCategory = sites.filter(s => s.category === key);
  
  if (sitesInCategory.length > 0) {
    const proceed = confirm(`'${categoryInfo.name}' ì¹´í…Œê³ ë¦¬ì— ${sitesInCategory.length}ê°œì˜ ì‚¬ì´íŠ¸ê°€ ìˆìŠµë‹ˆë‹¤.\nì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•˜ë©´ í•´ë‹¹ ì‚¬ì´íŠ¸ë“¤ì€ 'ì •ë³´' ì¹´í…Œê³ ë¦¬ë¡œ ì´ë™ë©ë‹ˆë‹¤.\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`);
    if (!proceed) return;
    
    sitesInCategory.forEach(site => {
      site.category = 'info';
    });
  }
  
  delete customCategories[key];
  delete categoryDisplayLimits[key];
  
  saveData();
  renderCategorySections();
  renderCustomCategories();
  renderSites();
  showPopup(`'${categoryInfo.name}' ì¹´í…Œê³ ë¦¬ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
}

// ì‚¬ì´íŠ¸ ì €ì¥ (ì¶”ê°€/ìˆ˜ì •)
function saveSite(event) {
  event.preventDefault();
  
  const name = document.getElementById("siteName").value.trim();
  const url = document.getElementById("siteUrl").value.trim();
  const desc = document.getElementById("siteDesc").value.trim();
  const category = document.getElementById("siteCategory").value;
  
  const ages = [];
  document.querySelectorAll('#ageCheckboxes input[type="checkbox"]:checked').forEach(cb => {
    ages.push(cb.value);
  });
  
  const subjects = [];
  document.querySelectorAll('#subjectCheckboxes input[type="checkbox"]:checked').forEach(cb => {
    subjects.push(cb.value);
  });
  
  if (!name || !url || !category) {
    showPopup("í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.", true);
    return;
  }
  
  if (ages.length === 0) {
    showPopup("ìµœì†Œ í•˜ë‚˜ì˜ ì—°ë ¹ëŒ€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.", true);
    return;
  }
  
  const newSite = {
    name: name,
    url: url,
    desc: desc,
    category: category,
    ages: ages,
    subjects: subjects.length > 0 ? subjects : ["general"]
  };
  
  if (editingIndex === -1) {
    sites.push(newSite);
    showPopup("ìƒˆ ì‚¬ì´íŠ¸ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!");
  } else {
    sites[editingIndex] = newSite;
    showPopup("ì‚¬ì´íŠ¸ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!");
  }
  
  saveData();
  renderSites();
  closeSiteModal();
}

// ì‚¬ì´íŠ¸ ì‚­ì œ
function deleteSite(index) {
  if (!isAdminLoggedIn && !checkAdminAuth()) return;
  const site = sites[index];
  if (confirm(`'${site.name}' ì‚¬ì´íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
    sites.splice(index, 1);
    saveData();
    renderSites();
    showPopup("ì‚¬ì´íŠ¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!");
  }
}

// ë°ì´í„° ë‚´ë³´ë‚´ê¸°
function exportData() {
  if (!isAdminLoggedIn && !checkAdminAuth()) return;
  try {
    const exportData = {
      sites: sites,
      customCategories: customCategories,
      version: "2.0",
      exportDate: new Date().toISOString()
    };
    const dataStr = JSON.stringify(exportData, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `education_sites_${new Date().toISOString().split('T')[0]}.json`;
    link.click();
    URL.revokeObjectURL(url);
    showPopup("ë°ì´í„°ê°€ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤!");
  } catch (error) {
    showPopup("ë°ì´í„° ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", true);
  }
}

// ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
function importData(event) {
  if (!isAdminLoggedIn && !checkAdminAuth()) return;
  const file = event.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = JSON.parse(e.target.result);
      
      if (confirm("ê¸°ì¡´ ë°ì´í„°ë¥¼ ëª¨ë‘ êµì²´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        if (data.sites && Array.isArray(data.sites)) {
          sites = data.sites;
        } else if (Array.isArray(data)) {
          sites = data;
        }
        
        if (data.customCategories) {
          customCategories = data.customCategories;
        }
        
        initializeDisplayLimits();
        saveData();
        renderCategorySections();
        renderCustomCategories();
        renderSites();
        showPopup("ë°ì´í„°ê°€ ê°€ì ¸ì™€ì¡ŒìŠµë‹ˆë‹¤!");
      }
    } catch (error) {
      showPopup("íŒŒì¼ì„ ì½ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", true);
    }
  };
  reader.readAsText(file);
  event.target.value = "";
}

// ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”
function resetAllData() {
  if (!isAdminLoggedIn && !checkAdminAuth()) return;
  if (confirm("ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) {
    sites = [...initialSites];
    customCategories = {};
    expandedCategories = {};
    
    initializeDisplayLimits();
    saveData();
    renderCategorySections();
    renderCustomCategories();
    renderSites();
    showPopup("ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!");
  }
}

// ë‹¤í¬ ëª¨ë“œ í† ê¸€
function toggleDarkMode() {
  document.body.classList.toggle("dark");
  const isDark = document.body.classList.contains("dark");
  showPopup(isDark ? "ğŸŒ™ ë‹¤í¬ ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤." : "â˜€ï¸ ë¼ì´íŠ¸ ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
}

// ì´ˆê¸°í™”
function init() {
  // ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©
  if (!loadData()) {
    sites = [...initialSites];
  }
  
  initializeDisplayLimits();
  renderCategorySections();
  setupFilters();
  updateAdminUI(); // ì´ í•¨ìˆ˜ê°€ renderCustomCategoriesë¥¼ í˜¸ì¶œí•¨
  renderSites();
}

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
document.addEventListener('DOMContentLoaded', init);

// ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
document.addEventListener('click', (e) => {
  if (e.target.classList.contains('modal-overlay')) {
    if (e.target.id === 'siteModal') {
      closeSiteModal();
    } else if (e.target.id === 'categoryModal') {
      closeCategoryModal();
    }
  }
});

// ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    if (document.getElementById('siteModal').style.display === 'flex') {
      closeSiteModal();
    }
    if (document.getElementById('categoryModal').style.display === 'flex') {
      closeCategoryModal();
    }
  }
});
</script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
// âœ… Firebase ì„¤ì • (ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
const firebaseConfig = {
  apiKey: "whoareyou",
  authDomain: "whoareyou",
  projectId: "whoareyou",
  storageBucket: "whoareyou",
  messagingSenderId: "whoareyou",
  appId: "whoareyou",
  measurementId: "whoareyou"
};
// Firebase ì´ˆê¸°í™”
// firebase.initializeApp(firebaseConfig);
// const db = firebase.firestore();

// ğŸ”¹ Firestore ì €ì¥ (ì„œë²„ ì €ì¥ ë²„íŠ¼ ê¸°ëŠ¥ êµì²´)
async function saveToServer() {
  showPopup("Firebase ì„¤ì •ì´ í•„ìš”í•˜ì—¬ ì„œë²„ ì €ì¥ì€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.", true);
  updateSaveStatus("ì„œë²„ ì €ì¥ ë¶ˆê°€ âœ—");
  return;
  /*
  try {
    const data = {
      sites: sites,
      customCategories: customCategories,
      categoryDisplayLimits: categoryDisplayLimits,
      timestamp: new Date().toISOString()
    };
    await db.collection("siteCollections").doc("myData").set(data);
    updateSaveStatus("â˜ï¸ Firebase ì €ì¥ ì™„ë£Œ âœ“");
    showPopup("Firebaseì— ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
    return true;
  } catch (err) {
    console.error(err);
    updateSaveStatus("Firebase ì €ì¥ ì‹¤íŒ¨ âœ—");
    showPopup("Firebase ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", true);
    return false;
  }
  */
}

// ğŸ”¹ Firestore ë¶ˆëŸ¬ì˜¤ê¸°
async function loadFromServer() {
  // Firebase ê¸°ëŠ¥ì€ ì‹¤ì œ ì„¤ì •ì´ í•„ìš”í•˜ë¯€ë¡œ, ë¡œì»¬ ë°ì´í„° ë¡œë“œë¥¼ ìš°ì„ í•˜ë„ë¡ ë³€ê²½
  return false;
  /*
  try {
    const doc = await db.collection("siteCollections").doc("myData").get();
    if (doc.exists) {
      const data = doc.data();
      sites = data.sites || [];
      customCategories = data.customCategories || {};
      categoryDisplayLimits = data.categoryDisplayLimits || {};
      renderCategorySections();
      renderCustomCategories();
      renderSites();
      updateSaveStatus("â˜ï¸ Firebaseì—ì„œ ë¶ˆëŸ¬ì˜´");
      return true;
    }
    return false;
  } catch (err) {
    console.error(err);
    showPopup("Firebase ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨", true);
    return false;
  }
  */
}

// ğŸ”¹ ê¸°ì¡´ init() ìˆ˜ì • â†’ Firebase ë¨¼ì € ë¶ˆëŸ¬ì˜¤ê¸°
async function init() {
  const loaded = await loadFromServer();
  if (!loaded) {
    if (!loadData()) {
      sites = [...initialSites];
    }
  }
  initializeDisplayLimits();
  renderCategorySections();
  setupFilters();
  updateAdminUI();
  renderCustomCategories();
  renderSites();
}

// document.removeEventListener('DOMContentLoaded', init); // ê¸°ì¡´ init ì œê±°
document.addEventListener('DOMContentLoaded', init); // ìˆ˜ì •ëœ init ì—°ê²°
</script>

<footer style="background:#333; color:#fff; text-align:center; padding:15px; margin-top:20px; font-size:14px;">
  Â© 2025 ë”±í•„ëª¨ | ì´ ì‚¬ì´íŠ¸ëŠ” Aië¥¼ ì´ìš©í•´ ì œì‘ë˜ì—ˆê³  ê°œì¸ì‚¬ìš©ì„ ëª©ì ìœ¼ë¡œ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤.
</footer>
</body>
</html>

