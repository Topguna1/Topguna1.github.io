<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ë”± í•„ìš”í•œ ì‚¬ì´íŠ¸ ëª¨ìŒ â€” ë·°ì–´ ë²„ì „</title>
<style>
/* --- ê¸°ë³¸ ìŠ¤íƒ€ì¼ (ì›ë³¸ì—ì„œ ê´€ë¦¬ì/ì €ì¥ ê´€ë ¨ UI ì œê±°ëœ ë²„ì „) --- */
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;
  padding: 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  color: #333;
  transition: all 0.3s ease;
}
body.dark {
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
  color: #fff;
}
.container {
  max-width: 1200px;
  margin: 0 auto;
  background: rgba(255,255,255,0.95);
  border-radius: 20px;
  backdrop-filter: blur(10px);
  box-shadow: 0 20px 40px rgba(0,0,0,0.1);
  overflow: hidden;
}
body.dark .container {
  background: rgba(26,26,46,0.95);
  box-shadow: 0 20px 40px rgba(0,0,0,0.3);
}

/* header */
.header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 30px;
  text-align: center;
  position: relative;
  overflow: hidden;
}
.header h1 { margin:0 0 8px 0; font-size:2.4em; font-weight:700; }
.header p { margin:0; opacity:0.95; }

/* top controls: ê²€ìƒ‰ + ë‹¤í¬ í† ê¸€ */
.top-controls {
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:space-between;
  padding:18px 24px;
  background: rgba(248,249,250,0.85);
  border-bottom:1px solid #e9ecef;
  flex-wrap:wrap;
}
body.dark .top-controls { background: rgba(40,40,60,0.6); border-bottom-color:#444; }
.search-box {
  display:flex;
  gap:8px;
  align-items:center;
  flex:1;
  min-width:220px;
}
.search-box input {
  width:100%;
  padding:12px 14px;
  border-radius:10px;
  border:2px solid #e9ecef;
  box-sizing:border-box;
  font-size:14px;
}
.search-box input:focus { outline:none; border-color:#667eea; box-shadow:0 0 0 4px rgba(102,126,234,0.08); }
.filter-tabs {
  display:flex;
  gap:8px;
  align-items:center;
  flex-wrap:wrap;
}
.tab-btn {
  padding:10px 14px;
  border-radius:18px;
  border:2px solid #e9ecef;
  background:white;
  cursor:pointer;
  font-weight:600;
}
.tab-btn.active { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; border-color:#667eea; box-shadow:0 6px 20px rgba(102,126,234,0.18); }
.dark-toggle { padding:10px 14px; border-radius:12px; background:linear-gradient(135deg,#343a40 0%,#212529 100%); color:white; border:none; cursor:pointer; }

/* filters area (age & subject simplified) */
.filters {
  padding:18px 24px;
  display:flex;
  gap:12px;
  align-items:center;
  flex-wrap:wrap;
  background: rgba(248,249,250,0.55);
  border-bottom:1px solid #e9ecef;
}
body.dark .filters { background: rgba(40,40,60,0.45); border-bottom-color:#444; }
.filter-group { display:flex; flex-direction:column; gap:8px; min-width:120px; }
.filter-buttons { display:flex; gap:8px; flex-wrap:wrap; }
.filter-btn { padding:8px 12px; border-radius:16px; border:2px solid #e9ecef; background:white; cursor:pointer; font-weight:600; }
.filter-btn.active { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; border-color:#667eea; }

/* stats */
.stats { display:flex; gap:18px; align-items:center; padding:12px 24px; color:#6c757d; background: rgba(248,249,250,0.28); }
body.dark .stats { color:#adb5bd; background: rgba(30,30,40,0.28); }
.stats-item { display:flex; gap:8px; align-items:center; }

/* categories grid */
.categories-container { padding:24px; display:grid; grid-template-columns:repeat(auto-fit,minmax(350px,1fr)); gap:20px; }
.category-section { background:white; border-radius:14px; overflow:hidden; border:1px solid #e9ecef; transition:all .25s ease; box-shadow:0 6px 20px rgba(0,0,0,0.06); }
body.dark .category-section { background:#2d2d2d; border-color:#444; box-shadow:0 8px 30px rgba(0,0,0,0.28); }
.category-header { padding:16px 20px; font-weight:700; display:flex; justify-content:space-between; align-items:center; gap:12px; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; }
.category-content { padding:18px; }
.link-card { border-radius:12px; padding:16px; margin:12px 0; background:linear-gradient(135deg,#ffffff 0%,#f8f9fa 100%); border:2px solid #f1f3f5; position:relative; transition:all .2s ease; }
body.dark .link-card { background:linear-gradient(135deg,#343a40 0%,#495057 100%); border-color:#444; }
.link-card:hover { transform:translateY(-3px); box-shadow:0 10px 25px rgba(102,126,234,0.12); border-color:#667eea; }
.link-card a { text-decoration:none; font-weight:700; display:inline-block; color:#2c3e50; font-size:18px; }
body.dark .link-card a { color:#f8f9fa; }
.link-card p { margin:8px 0 0; color:#6c757d; }
body.dark .link-card p { color:#adb5bd; }
.tag { padding:4px 10px; border-radius:12px; font-size:12px; font-weight:700; margin-right:6px; display:inline-block; }
.age-tag { background:linear-gradient(135deg,#d4edda 0%,#c3e6cb 100%); color:#155724; }
.category-tag { background:linear-gradient(135deg,#fff3cd 0%,#ffeaa7 100%); color:#856404; }
body.dark .age-tag { background:linear-gradient(135deg,#28a745 0%,#20c997 100%); color:white; }
body.dark .category-tag { background:linear-gradient(135deg,#ffc107 0%,#fd7e14 100%); color:#212529; }

/* more/collapse */
.more-btn-container { text-align:center; margin-top:12px; }
.more-btn, .collapse-btn { padding:10px 18px; border-radius:22px; border:2px solid #dee2e6; background:linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%); cursor:pointer; font-weight:700; }
.more-btn:hover, .collapse-btn:hover { background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; border-color:#667eea; }

/* no results */
.no-results { padding:40px; text-align:center; font-style:italic; color:#6c757d; }

/* responsive */
@media (max-width:768px) {
  .categories-container { grid-template-columns:1fr; padding:16px; }
  .header h1 { font-size:1.8em; }
}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>ğŸŒŸ ë”±í•„ëª¨ â€” ë·°ì–´</h1>
    <p>ë”± í•„ìš”í•œ ì‚¬ì´íŠ¸ë§Œ ê¹”ë”í•˜ê²Œ ëª¨ì•„ë´¤ì–´ìš” (ì½ê¸° ì „ìš©)</p>
  </div>

  <div class="top-controls">
    <div class="search-box" style="margin-right:12px;">
      <input id="searchInput" placeholder="ì‚¬ì´íŠ¸ ì´ë¦„ ë˜ëŠ” ì„¤ëª…ìœ¼ë¡œ ê²€ìƒ‰í•˜ì„¸ìš” â€” ì˜ˆ: Khan, ë²ˆì—­..." />
    </div>

    <div class="filter-tabs" id="filterTabs">
      <!-- íƒ­ì€ JSì—ì„œ ë™ì ìœ¼ë¡œ ì±„ì›ë‹ˆë‹¤ -->
    </div>

    <button class="dark-toggle" id="darkToggle">ğŸŒ™ ë‹¤í¬ ëª¨ë“œ</button>
  </div>

  <div class="filters">
    <div class="filter-group">
      <label>ğŸ¯ ì—°ë ¹ëŒ€</label>
      <div class="filter-buttons" id="ageFilter">
        <button class="filter-btn active" data-age="all">ì „ì²´</button>
        <button class="filter-btn" data-age="elem">ì´ˆë“±</button>
        <button class="filter-btn" data-age="mid">ì¤‘ë“±</button>
        <button class="filter-btn" data-age="high">ê³ ë“±</button>
        <button class="filter-btn" data-age="adult">ì„±ì¸</button>
      </div>
    </div>

    <div class="filter-group">
      <label>ğŸ“š ê³¼ëª©</label>
      <select id="subjectFilter" style="padding:10px;border-radius:10px;border:2px solid #e9ecef;">
        <option value="all">ì „ì²´ ê³¼ëª©</option>
        <option value="korean">êµ­ì–´</option>
        <option value="math">ìˆ˜í•™</option>
        <option value="english">ì˜ì–´</option>
        <option value="science">ê³¼í•™</option>
        <option value="social">ì‚¬íšŒ</option>
        <option value="history">ì—­ì‚¬</option>
        <option value="art">ì˜ˆìˆ </option>
        <option value="music">ìŒì•…</option>
        <option value="pe">ì²´ìœ¡</option>
        <option value="tech">ê¸°ìˆ </option>
        <option value="coding">ì½”ë”©</option>
        <option value="language">ì™¸êµ­ì–´</option>
        <option value="general">ì¢…í•©</option>
        <option value="exam">ì‹œí—˜ëŒ€ë¹„</option>
        <option value="career">ì§„ë¡œ</option>
      </select>
    </div>

    <div style="margin-left:auto;">
      <button onclick="resetFilters()" style="padding:10px 14px;border-radius:10px;border:none;background:#6c757d;color:white;cursor:pointer;">ğŸ”„ í•„í„° ì´ˆê¸°í™”</button>
    </div>
  </div>

  <div class="stats" id="statsBar">
    <div class="stats-item">ğŸ“Š ì´ <strong id="totalCount">0</strong>ê°œ ì‚¬ì´íŠ¸</div>
    <div class="stats-item">ğŸ” ê²€ìƒ‰ ê²°ê³¼: <strong id="filteredCount">0</strong>ê°œ</div>
  </div>

  <div class="categories-container" id="categoriesContainer"></div>

  <div id="noResults" class="no-results" style="display:none;">
    <h3>ğŸ” ì¡°ê±´ì— ë§ëŠ” ì‚¬ì´íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
    <p>í•„í„°ë‚˜ ê²€ìƒ‰ì–´ë¥¼ ë°”ê¿”ë³´ì„¸ìš”.</p>
  </div>
</div>

<script>
/* ===== ë°ì´í„° & ì„¤ì • ===== */
const ageNames = {elem:"ì´ˆë“±í•™ìƒ", mid:"ì¤‘í•™ìƒ", high:"ê³ ë“±í•™ìƒ", adult:"ì„±ì¸"};
const subjectNames = {korean:"êµ­ì–´", math:"ìˆ˜í•™", english:"ì˜ì–´", science:"ê³¼í•™", social:"ì‚¬íšŒ", history:"ì—­ì‚¬", art:"ì˜ˆìˆ ", music:"ìŒì•…", pe:"ì²´ìœ¡", tech:"ê¸°ìˆ ", coding:"ì½”ë”©", language:"ì™¸êµ­ì–´", general:"ì¢…í•©", exam:"ì‹œí—˜ëŒ€ë¹„", career:"ì§„ë¡œ"};

/* ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ (ê´€ë¦¬ì/ì»¤ìŠ¤í…€ ì œê±°) */
const defaultCategories = {
  learning: {name:"í•™ìŠµ ì‚¬ì´íŠ¸", icon:"ğŸ“–"},
  info: {name:"ì •ë³´ ì‚¬ì´íŠ¸", icon:"ğŸ“‹"},
  government: {name:"ì •ë¶€ê¸°ê´€", icon:"ğŸ›ï¸"},
  search: {name:"ê²€ìƒ‰ ì—”ì§„", icon:"ğŸ”"},
  gpt: {name:"GPT í™œìš©", icon:"ğŸ¤–"}
  science_lab: { name: "ê³¼í•™ ì‹¤í—˜", icon: "ğŸ§ª" },
  career_info: { name: "ì§„ë¡œ ì •ë³´", icon: "ğŸ’¼" },
  psychology: { name: "ì‹¬ë¦¬/ìê¸°ê³„ë°œ", icon: "ğŸ§ " },
  ebooks: { name: "ë¬´ë£Œ ì „ìì±…", icon: "ğŸ“š" }
};

/* ì´ˆê¸° ì‚¬ì´íŠ¸ (ì½ê¸° ì „ìš©) */
const initialSites = [
  // ê¸°ì¡´ í•™ìŠµ ì‚¬ì´íŠ¸
  {name:"EBS ì´ˆë“±",url:"https://www.ebs.co.kr/course/home?courseType=ELMT",desc:"ì´ˆë“± ì „ ê³¼ëª© ì˜¨ë¼ì¸ ê°•ì˜",category:"learning",ages:["elem"],subjects:["korean","math","science","social"]},
  {name:"Khan Academy",url:"https://ko.khanacademy.org/",desc:"ìˆ˜í•™, ê³¼í•™ ë¬´ë£Œ ê°•ì˜",category:"learning",ages:["elem","mid","high","adult"],subjects:["math","science"]},
  {name:"Code.org",url:"https://code.org",desc:"ì´ˆë“±~ê³ ë“± ì½”ë”© í•™ìŠµ",category:"learning",ages:["elem","mid","high"],subjects:["coding"]},
  {name:"Duolingo",url:"https://www.duolingo.com/",desc:"ì™¸êµ­ì–´ í•™ìŠµ ê²Œì„í˜• í”Œë«í¼",category:"learning",ages:["elem","mid","high","adult"],subjects:["language","english"]},
  {name:"Coursera",url:"https://www.coursera.org/",desc:"ì „ ì„¸ê³„ ëŒ€í•™ ë° ê¸°ì—…ì˜ ì˜¨ë¼ì¸ ê°•ì¢Œ",category:"learning",ages:["high","adult"],subjects:["general","language"]},

  // ê¸°ì¡´ ì •ë³´/ì •ë¶€/ê²€ìƒ‰/GPT ì‚¬ì´íŠ¸ ...
  {name:"ìœ„í‚¤ë°±ê³¼",url:"https://ko.wikipedia.org/",desc:"ììœ  ë°±ê³¼ì‚¬ì „",category:"info",ages:["mid","high","adult"],subjects:["general"]},
  {name:"êµ­ë¦½ì¤‘ì•™ê³¼í•™ê´€",url:"https://www.science.go.kr/",desc:"ê³¼í•™ ì²´í—˜ ë° êµìœ¡ ì •ë³´",category:"info",ages:["elem","mid","high"],subjects:["science"]},
  {name:"ë‚˜ë¬´ìœ„í‚¤",url:"https://namu.wiki/",desc:"ë‹¤ì–‘í•œ ì£¼ì œë¥¼ ë‹¤ë£¨ëŠ” í•œêµ­ì–´ ìœ„í‚¤",category:"info",ages:["mid","high","adult"],subjects:["general"]},
  {name:"êµìœ¡ë¶€",url:"https://www.moe.go.kr/",desc:"ëŒ€í•œë¯¼êµ­ êµìœ¡ë¶€ ê³µì‹ ì‚¬ì´íŠ¸",category:"government",ages:["adult"],subjects:["general"]},
  {name:"í•œêµ­êµìœ¡ê³¼ì •í‰ê°€ì›",url:"https://www.kice.re.kr/",desc:"êµìœ¡ê³¼ì • ë° í‰ê°€ ì •ë³´",category:"government",ages:["mid","high","adult"],subjects:["general","exam"]},
  {name:"í•œêµ­êµìœ¡í•™ìˆ ì •ë³´ì›",url:"https://www.keris.or.kr/",desc:"êµìœ¡ ì •ë³´í™” ë° í•™ìˆ  ì •ë³´",category:"government",ages:["high","adult"],subjects:["general"]},
  {name:"êµ­ë¯¼ì‹ ë¬¸ê³ ",url:"https://www.epeople.go.kr/",desc:"ì •ë¶€ì— ì •ì±… ë° ë¯¼ì›ì„ ì œì•ˆí•˜ëŠ” ì˜¨ë¼ì¸ ì†Œí†µ ì°½êµ¬",category:"government",ages:["adult"],subjects:["general","social"]},
  {name:"ë„¤ì´ë²„",url:"https://www.naver.com/",desc:"ëŒ€í•œë¯¼êµ­ ëŒ€í‘œ í¬í„¸ì‚¬ì´íŠ¸",category:"search",ages:["elem","mid","high","adult"],subjects:["general"]},
  {name:"êµ¬ê¸€",url:"https://www.google.com/",desc:"ì„¸ê³„ ìµœëŒ€ ê²€ìƒ‰ì—”ì§„",category:"search",ages:["elem","mid","high","adult"],subjects:["general"]},
  {name:"DuckDuckGo",url:"https://duckduckgo.com/",desc:"ê°œì¸ì •ë³´ ë³´í˜¸ì— ì¤‘ì ì„ ë‘” ê²€ìƒ‰ ì—”ì§„",category:"search",ages:["mid","high","adult"],subjects:["general"]},
  {name:"ChatGPT", url:"https://chat.openai.com/", desc:"OpenAIì—ì„œ ê°œë°œí•œ ëŒ€í™”í˜• ì¸ê³µì§€ëŠ¥ ëª¨ë¸", category:"gpt", ages:["mid", "high", "adult"], subjects:["general", "coding"]},
  {name:"Poe by Quora", url:"https://poe.com/", desc:"ë‹¤ì–‘í•œ AI ì±—ë´‡ì„ í•œê³³ì—ì„œ ê²½í—˜í•  ìˆ˜ ìˆëŠ” í”Œë«í¼", category:"gpt", ages:["high", "adult"], subjects:["general"]},
  {name:"DeepL", url:"https://www.deepl.com/translator", desc:"AI ê¸°ë°˜ì˜ ê³ í’ˆì§ˆ ë²ˆì—­ ì„œë¹„ìŠ¤", category:"gpt", ages:["mid", "high", "adult"], subjects:["language"]},
  {name:"Gamma", url:"https://gamma.app/", desc:"AIë¥¼ í™œìš©í•˜ì—¬ í”„ë ˆì  í…Œì´ì…˜, ë¬¸ì„œë¥¼ ë¹ ë¥´ê²Œ ì œì‘", category:"gpt", ages:["high", "adult"], subjects:["tech", "art"]},

  // ì‹ ê·œ ì¹´í…Œê³ ë¦¬/ì‚¬ì´íŠ¸ ì¶”ê°€
  {name:"Science Kids", url:"https://www.sciencekids.co.nz/", desc:"ì´ˆë“±í•™ìƒì„ ìœ„í•œ ì¬ë¯¸ìˆëŠ” ê³¼í•™ ì‹¤í—˜ê³¼ ìë£Œ", category:"science_lab", ages:["elem"], subjects:["science"]},
  {name:"DIY.org", url:"https://www.diy.org/", desc:"ì°½ì˜ë ¥ê³¼ ê³µì˜ˆ í™œë™ì„ ë°°ìš¸ ìˆ˜ ìˆëŠ” í”Œë«í¼", category:"science_lab", ages:["elem","mid"], subjects:["art","tech"]},
  {name:"ì»¤ë¦¬ì–´ë„·", url:"https://www.career.go.kr/", desc:"ì§„ë¡œ íƒìƒ‰, ì§ì—… ì •ë³´ ì œê³µ", category:"career_info", ages:["mid","high","adult"], subjects:["career"]},
  {name:"Headspace", url:"https://www.headspace.com/", desc:"ëª…ìƒ ë° ë§ˆìŒ ì±™ê¹€ í”„ë¡œê·¸ë¨ ì œê³µ", category:"psychology", ages:["high","adult"], subjects:["general"]},
  {name:"MindTools", url:"https://www.mindtools.com/", desc:"ë¦¬ë”ì‹­, ìê¸°ê³„ë°œ ìë£Œ ì œê³µ", category:"psychology", ages:["adult"], subjects:["general"]},
  {name:"Project Gutenberg", url:"https://www.gutenberg.org/", desc:"ë¬´ë£Œ ì „ìì±… ì œê³µ ì‚¬ì´íŠ¸", category:"ebooks", ages:["mid","high","adult"], subjects:["general","language"]},
  {name:"Open Library", url:"https://openlibrary.org/", desc:"ë‹¤ì–‘í•œ ì±…ì„ ì˜¨ë¼ì¸ìœ¼ë¡œ ë¬´ë£Œ ì—´ëŒ", category:"ebooks", ages:["mid","high","adult"], subjects:["general","language"]}
];
/* ===== ë‚´ë¶€ ìƒíƒœ ===== */
let sites = [...initialSites];
let currentAgeFilter = "all";
let currentCategoryFilter = "all";
let currentSubjectFilter = "all";
let currentSearchQuery = "";
let expandedCategories = {};
const DEFAULT_DISPLAY_LIMIT = 5; // ê¸°ë³¸ ë…¸ì¶œ ê°œìˆ˜ (ìš”ì²­ëŒ€ë¡œ ì¼ì • ìˆ˜ì¤€ ì´ìƒì´ë©´ ë”ë³´ê¸° í‘œì‹œ)

/* ===== ìœ í‹¸ë¦¬í‹° ===== */
function getAllCategories() { return {...defaultCategories}; }
function getCategoryName(key) { const c = getAllCategories()[key]; return c ? c.name : key; }
function getCategoryIcon(key) { const c = getAllCategories()[key]; return c ? c.icon : "ğŸ“"; }

function updateStats() {
  document.getElementById("totalCount").textContent = sites.length;
  document.getElementById("filteredCount").textContent = getFilteredSites().length;
}

/* ===== í•„í„°ë§ & ê²€ìƒ‰ ===== */
function getFilteredSites() {
  const q = currentSearchQuery.trim().toLowerCase();
  return sites.filter(s => {
    if (currentAgeFilter !== "all" && !s.ages.includes(currentAgeFilter)) return false;
    if (currentCategoryFilter !== "all" && s.category !== currentCategoryFilter) return false;
    if (currentSubjectFilter !== "all" && !s.subjects.includes(currentSubjectFilter)) return false;
    if (q) {
      const hay = (s.name + " " + (s.desc || "")).toLowerCase();
      if (!hay.includes(q)) return false;
    }
    return true;
  });
}

/* ===== DOM ìƒì„±: ì¹´í…Œê³ ë¦¬ ì„¹ì…˜, ì¹´ë“œ, ë Œë”ë§ ===== */
function createCategorySection(categoryKey) {
  const allCategories = getAllCategories();
  const info = allCategories[categoryKey];
  if (!info) return null;
  const section = document.createElement("div");
  section.className = "category-section";
  section.id = `${categoryKey}-section`;
  section.innerHTML = `
    <div class="category-header">
      <div style="display:flex;align-items:center;gap:10px;">
        <span style="font-size:20px;">${info.icon}</span>
        <div>
          <div style="font-weight:800">${info.name}</div>
          <div style="font-size:12px;opacity:0.9">ì¹´í…Œê³ ë¦¬: ${categoryKey}</div>
        </div>
      </div>
      <div class="category-count" id="${categoryKey}-count">0</div>
    </div>
    <div class="category-content" id="${categoryKey}-content"></div>
  `;
  return section;
}

function createSiteCard(site) {
  const card = document.createElement("div");
  card.className = "link-card";
  const ageTags = site.ages.map(a => `<span class="tag age-tag">${ageNames[a]}</span>`).join(" ");
  const categoryTag = `<span class="tag category-tag">${getCategoryName(site.category)}</span>`;
  card.innerHTML = `
    <a href="${site.url}" target="_blank" rel="noopener">${escapeHtml(site.name)}</a>
    <div style="margin-top:10px;">${categoryTag} ${ageTags}</div>
    <p>${escapeHtml(site.desc || 'ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.')}</p>
  `;
  return card;
}

/* ì•ˆì „í•œ HTML ì´ìŠ¤ì¼€ì´í”„ */
function escapeHtml(str) {
  return String(str)
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;")
    .replace(/"/g,"&quot;")
    .replace(/'/g,"&#039;");
}

function renderCategorySections() {
  const container = document.getElementById("categoriesContainer");
  container.innerHTML = "";
  const keys = Object.keys(getAllCategories());
  keys.forEach(k => {
    const sec = createCategorySection(k);
    if (sec) container.appendChild(sec);
  });
}

function renderSites() {
  const allKeys = Object.keys(getAllCategories());
  const filtered = getFilteredSites();
  const hasResults = filtered.length > 0;

  allKeys.forEach(category => {
    const content = document.getElementById(`${category}-content`);
    const section = document.getElementById(`${category}-section`);
    const countEl = document.getElementById(`${category}-count`);
    if (!content || !section) return;

    const sitesInCategory = filtered.filter(s => s.category === category);
    content.innerHTML = "";
    if (countEl) countEl.textContent = sitesInCategory.length;

    if (sitesInCategory.length > 0) {
      section.style.display = "block";
      const limit = DEFAULT_DISPLAY_LIMIT;
      const isExpanded = expandedCategories[category];
      const toShow = isExpanded ? sitesInCategory : sitesInCategory.slice(0, limit);
      const remaining = Math.max(0, sitesInCategory.length - limit);

      toShow.forEach(s => content.appendChild(createSiteCard(s)));

      if (sitesInCategory.length > limit) {
        const btnContainer = document.createElement("div");
        btnContainer.className = "more-btn-container";
        if (isExpanded) {
          btnContainer.innerHTML = `<button class="collapse-btn" onclick="collapseSites('${category}')">ì ‘ê¸° â†‘</button>`;
        } else {
          btnContainer.innerHTML = `<button class="more-btn" onclick="expandSites('${category}')">ë”ë³´ê¸° (${remaining}ê°œ ë” ìˆìŒ) â†“</button>`;
        }
        content.appendChild(btnContainer);
      }
    } else {
      // ì¹´í…Œê³ ë¦¬ í•„í„°ê°€ ì „ì²´ or ì´ ì¹´í…Œê³ ë¦¬ê°€ ì„ íƒëœ ê²½ìš° ë¹ˆ ë©”ì‹œì§€ ë³´ì´ê¸°
      if (currentCategoryFilter === "all" || currentCategoryFilter === category) {
        section.style.display = "block";
        content.innerHTML = "<p style='color:#666;text-align:center;padding:20px;'>í•´ë‹¹ ì¡°ê±´ì˜ ì‚¬ì´íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
      } else {
        section.style.display = "none";
      }
    }
  });

  document.getElementById("noResults").style.display = hasResults ? "none" : "block";
  updateStats();
}

/* ë”ë³´ê¸°/ì ‘ê¸° */
function expandSites(category) {
  if (!expandedCategories[category]) expandedCategories[category] = 0;

  expandedCategories[category] += 5; // 5ê°œì”© ì¶”ê°€ í‘œì‹œ

  const filtered = getFilteredSites().filter(s => s.category === category);
  if (expandedCategories[category] >= filtered.length) {
    // ëª¨ë“  ì‚¬ì´íŠ¸ë¥¼ ë‹¤ í¼ì³¤ìœ¼ë©´ â†’ ê·¸ ì¹´í…Œê³ ë¦¬ë§Œ ë³´ì´ê²Œ
    currentCategoryFilter = category;
  }

  renderSites();
}
function collapseSites(category) { expandedCategories[category] = false; renderSites(); }

/* ===== í•„í„° íƒ­(ì¹´í…Œê³ ë¦¬ íƒ­) ìƒì„± & ì´ë²¤íŠ¸ ===== */
function buildCategoryTabs() {
  const tabs = document.getElementById("filterTabs");
  tabs.innerHTML = "";
  const allCats = getAllCategories();
  const keys = Object.keys(allCats);
  // 'ì „ì²´' íƒ­ ì¶”ê°€
  const allBtn = document.createElement("button");
  allBtn.className = "tab-btn active";
  allBtn.dataset.cat = "all";
  allBtn.textContent = "ì „ì²´";
  allBtn.addEventListener("click", e => {
    document.querySelectorAll("#filterTabs .tab-btn").forEach(b=>b.classList.remove("active"));
    e.currentTarget.classList.add("active");
    currentCategoryFilter = "all";
    expandedCategories = {};
    renderSites();
  });
  tabs.appendChild(allBtn);

  keys.forEach(k => {
    const btn = document.createElement("button");
    btn.className = "tab-btn";
    btn.dataset.cat = k;
    btn.textContent = `${allCats[k].icon} ${allCats[k].name}`;
    btn.addEventListener("click", e => {
      document.querySelectorAll("#filterTabs .tab-btn").forEach(b=>b.classList.remove("active"));
      e.currentTarget.classList.add("active");
      currentCategoryFilter = e.currentTarget.dataset.cat;
      expandedCategories = {};
      renderSites();
    });
    tabs.appendChild(btn);
  });
}

/* ===== í•„í„°/ê²€ìƒ‰ ì´ë²¤íŠ¸ ì—°ê²° ===== */
function setupFilters() {
  document.querySelectorAll("#ageFilter .filter-btn").forEach(btn => {
    btn.addEventListener("click", e => {
      document.querySelectorAll("#ageFilter .filter-btn").forEach(b=>b.classList.remove("active"));
      e.currentTarget.classList.add("active");
      currentAgeFilter = e.currentTarget.dataset.age;
      renderSites();
    });
  });

  document.getElementById("subjectFilter").addEventListener("change", e => {
    currentSubjectFilter = e.target.value;
    renderSites();
  });

  document.getElementById("searchInput").addEventListener("input", e => {
    currentSearchQuery = e.target.value;
    renderSites();
  });

  document.getElementById("darkToggle").addEventListener("click", () => {
    document.body.classList.toggle("dark");
  });
}

/* ===== ì´ˆê¸°í™” & ìœ í‹¸ ===== */
function resetFilters() {
  currentAgeFilter = "all";
  currentCategoryFilter = "all";
  currentSubjectFilter = "all";
  currentSearchQuery = "";
  document.getElementById("searchInput").value = "";
  document.querySelector("#ageFilter .filter-btn[data-age='all']").classList.add("active");
  // reset other age buttons
  document.querySelectorAll("#ageFilter .filter-btn:not([data-age='all'])").forEach(b=>b.classList.remove("active"));
  document.getElementById("subjectFilter").value = "all";
  // reset tabs
  document.querySelectorAll("#filterTabs .tab-btn").forEach(b=>b.classList.remove("active"));
  document.querySelector("#filterTabs .tab-btn[data-cat='all']").classList.add("active");
  expandedCategories = {};
  currentCategoryFilter = "all";
  renderSites();
}

function init() {
  renderCategorySections();
  buildCategoryTabs();
  setupFilters();
  renderSites();
}

/* DOMContentLoaded */
document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>

