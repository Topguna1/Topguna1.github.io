<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ë”±í•„ëª¨ â€” í•™ìƒìš© íë ˆì´ì…˜ í¬í„¸</title>
  <meta name="description" content="ëŒ€í•œë¯¼êµ­ í•™ìƒë“¤ì„ ìœ„í•œ ì—„ì„ ëœ í•™ìŠµÂ·ì°¸ê³ Â·ì§„ë¡œ ì‚¬ì´íŠ¸ ëª¨ìŒ â€” ì „ë¬¸ê°€ ì¶”ì²œ, ì‹œê¸°ë³„/í•™ë…„ë³„ íë ˆì´ì…˜ê³¼ í™œìš© ê°€ì´ë“œ ì œê³µ" />
  <meta name="author" content="ë”±í•„ëª¨" />
  <meta name="keywords" content="í•™ìƒ,í•™ìŠµ,ì°¸ê³ ìë£Œ,ìˆ˜ëŠ¥,ê°•ì˜,íë ˆì´ì…˜,êµì‚¬ì¶”ì²œ" />
  <!-- Open Graph -->
  <meta property="og:title" content="ë”±í•„ëª¨ â€” í•™ìƒìš© íë ˆì´ì…˜ í¬í„¸" />
  <meta property="og:description" content="ëŒ€í•œë¯¼êµ­ í•™ìƒë“¤ì„ ìœ„í•œ ì—„ì„ ëœ í•™ìŠµÂ·ì°¸ê³ Â·ì§„ë¡œ ì‚¬ì´íŠ¸ ëª¨ìŒ" />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="ko_KR" />
  <!-- JSON-LD êµ¬ì¡°í™” ë°ì´í„° (ì‚¬ì´íŠ¸ ê°œìš”) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "ë”±í•„ëª¨",
    "url": "https://example.com/",
    "description": "ëŒ€í•œë¯¼êµ­ í•™ìƒë“¤ì„ ìœ„í•œ ì—„ì„ ëœ í•™ìŠµÂ·ì°¸ê³ Â·ì§„ë¡œ ì‚¬ì´íŠ¸ ëª¨ìŒ",
    "inLanguage": "ko-KR"
  }
  </script>

  <style>
    :root{
      --bg1: #f5f7fb;
      --card: #fff;
      --muted:#6c757d;
      --accent1:#6c63ff;
      --accent2:#7b61ff;
      --glass: rgba(255,255,255,0.6);
      --radius:14px;
    }
    [data-theme="dark"]{
      --bg1:#0f141a;
      --card:#121416;
      --muted:#9aa3b2;
      --accent1:#7b61ff;
      --accent2:#5a41d6;
      --glass: rgba(20,20,30,0.6);
    }
    html,body{height:100%;margin:0;font-family:Inter, "Noto Sans KR", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    body{background:linear-gradient(180deg,var(--bg1),#e9eef9 60%);padding:20px;transition:background .3s,color .3s;}
    .app{max-width:1200px;margin:0 auto;background:var(--glass);border-radius:18px;padding:16px;box-shadow:0 20px 40px rgba(2,6,23,0.12);backdrop-filter: blur(6px);}
    header{display:flex;align-items:center;gap:12px;padding:16px 8px;}
    .logo{display:flex;align-items:center;gap:10px;}
    .logo h1{margin:0;font-size:1.4rem;letter-spacing:-0.5px;}
    .controls{margin-left:auto;display:flex;gap:8px;align-items:center;}
    input.search{padding:10px 12px;border-radius:12px;border:1px solid rgba(0,0,0,0.08);min-width:220px;box-shadow:inset 0 1px 0 rgba(255,255,255,0.4);transition:box-shadow .12s, border-color .12s;}
    input.search:focus{outline:none;border-color:var(--accent1);box-shadow:0 6px 18px rgba(99,88,255,0.12);}
    .btn{padding:9px 12px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;font-weight:600;cursor:pointer;}
    .btn.ghost{background:transparent;color:var(--muted);border:1px solid rgba(0,0,0,0.06);}
    nav.tabs{display:flex;gap:8px;padding:12px 8px;flex-wrap:wrap;}
    .tab{padding:8px 12px;border-radius:999px;background:transparent;border:1px solid rgba(0,0,0,0.04);cursor:pointer;}
    .tab.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;border-color:transparent;box-shadow:0 8px 30px rgba(99,88,255,0.12);}

    /* grid */
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;padding:14px;}
    .card{background:var(--card);border-radius:12px;padding:14px;border:1px solid rgba(0,0,0,0.04);position:relative;transition:transform .14s ease,box-shadow .14s;}
    .card:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(48,45,73,0.08);}
    .card .title{font-weight:800;font-size:1.05rem;display:flex;gap:8px;align-items:center;}
    .desc{color:var(--muted);font-size:0.95rem;margin-top:6px;}
    .meta{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;}
    .tag{padding:6px 8px;border-radius:10px;background:linear-gradient(180deg,#f1f3ff,#fff);font-weight:700;font-size:12px;color:#333;}
    [data-theme="dark"] .tag{background:linear-gradient(180deg,#2b2c3a,#23232f);color:#fff;}

    /* actions */
    .card-actions{position:absolute;right:12px;top:12px;display:flex;gap:6px;}
    .icon-btn{width:36px;height:36px;border-radius:10px;border:none;background:transparent;display:inline-flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px;}
    .icon-btn.q{background:linear-gradient(90deg,rgba(99,88,255,0.1),rgba(123,97,255,0.08));}
    .icon-btn.bookmark{background:linear-gradient(90deg,rgba(255,210,64,0.08),rgba(255,150,0,0.06));}

    /* guide panel */
    .guide-panel{padding:12px;border-radius:12px;background:linear-gradient(180deg,#fff,#fbfbff);margin:6px 0;border:1px solid rgba(0,0,0,0.04);}
    [data-theme="dark"] .guide-panel{background:linear-gradient(180deg,#1b1b2a,#14141b);}

    /* preview modal */
    .modal{position:fixed;left:0;top:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:rgba(2,6,23,0.5);z-index:999;opacity:0;pointer-events:none;transition:opacity .12s;}
    .modal.open{opacity:1;pointer-events:auto;}
    .modal .box{width:90%;max-width:1100px;height:80%;background:var(--card);border-radius:12px;overflow:hidden;display:flex;flex-direction:column;}
    .modal .frame{flex:1;border:0;}
    .modal .modal-head{padding:12px 14px;display:flex;align-items:center;gap:8px;border-bottom:1px solid rgba(0,0,0,0.04);}
    .modal .modal-head .title{font-weight:800;}
    .close-x{margin-left:auto;background:transparent;border:none;font-size:18px;padding:6px;cursor:pointer;}

    /* loading spinner */
    .spinner{width:36px;height:36px;border-radius:50%;border:4px solid rgba(0,0,0,0.06);border-top-color:var(--accent1);animation:spin 1s linear infinite;}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* drag handle */
    .drag-handle{cursor:grab;padding:6px;border-radius:8px;border:1px dashed rgba(0,0,0,0.04);background:transparent;font-size:13px;color:var(--muted);display:inline-flex;align-items:center;gap:6px;}
    .dragging{opacity:0.6;transform:scale(.98) rotate(-1deg);}

    /* small responsive */
    @media (max-width:640px){ .controls{flex-direction:column;gap:6px} input.search{width:100%} .modal .box{height:90%} }

    /* micro interactions */
    .pulse{animation:pulse 2.2s infinite;}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.02)}100%{transform:scale(1)}}
  </style>
</head>
<body data-theme="light">
  <div class="app" role="main" aria-live="polite">
    <header>
      <div class="logo">
        <div style="font-size:1.8rem">ğŸŒŸ</div>
        <div>
          <h1>ë”±í•„ëª¨</h1>
          <div style="font-size:12px;color:var(--muted)">í•™ìƒë“¤ì„ ìœ„í•œ ì—„ì„ ëœ ì‚¬ì´íŠ¸ & ì‹¤ì „ ê°€ì´ë“œ</div>
        </div>
      </div>

      <div class="controls" aria-hidden="false">
        <input id="search" class="search" placeholder="ì‚¬ì´íŠ¸ ì´ë¦„/ì„¤ëª… ê²€ìƒ‰ â€” '/' í‚¤ë¥¼ ëˆŒëŸ¬ ë°”ë¡œ ê²€ìƒ‰" autocomplete="off" />
        <button id="guideToggle" class="btn ghost" title="ê°€ì´ë“œ ë³´ì´ê¸°/ìˆ¨ê¸°ê¸°">ê°€ì´ë“œ í† ê¸€ (G)</button>
        <button id="themeToggle" class="btn" title="ë‹¤í¬ ëª¨ë“œ ì „í™˜ (D)">ë‹¤í¬ëª¨ë“œ</button>
      </div>
    </header>

    <nav class="tabs" id="tabs">
      <button class="tab active" data-tab="expert">êµì‚¬/ì „ë¬¸ê°€ ì¶”ì²œ</button>
      <button class="tab" data-tab="season">ì‹œê¸°ë³„ ì¶”ì²œ</button>
      <button class="tab" data-tab="grade">í•™ë…„ë³„ ì¶”ì²œ</button>
      <button class="tab" data-tab="all">ì „ì²´</button>
    </nav>

    <section id="guideArea" class="guide-panel" aria-hidden="false">
      <strong>ê°€ì´ë“œ ìš”ì•½</strong>
      <div id="guideSummary" style="margin-top:8px;color:var(--muted);">
        â€” ê° ì‚¬ì´íŠ¸ë³„ í™œìš©ë²•, ì‹œí—˜/ë°©í•™ì— ë”°ë¥¸ ì¶”ì²œ, ê³¼ëª©ë³„ ì¡°í•© íŒì„ ì¹´ë“œì—ì„œ í™•ì¸í•˜ì„¸ìš”.
      </div>
    </section>

    <main>
      <div id="grid" class="grid" aria-live="polite"></div>
    </main>
  </div>

  <!-- preview modal -->
  <div id="previewModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="box" role="document">
      <div class="modal-head">
        <div class="title" id="modalTitle">ì‚¬ì´íŠ¸ ë¯¸ë¦¬ë³´ê¸°</div>
        <button class="close-x" id="closePreview">âœ•</button>
      </div>
      <iframe id="previewFrame" class="frame" title="ì‚¬ì´íŠ¸ ë¯¸ë¦¬ë³´ê¸°"></iframe>
    </div>
  </div>

  <script>
  /***********************
   * ì´ˆê¸° ë°ì´í„° ì •ì˜ (ì‚¬ì´íŠ¸ + ê°€ì´ë“œ + ë©”íƒ€)
   ***********************/
  const initialSites = [
    {
      id: 'ebs',
      name:'EBS ì´ˆë“±/ì¤‘/ê³ ',
      url:'https://www.ebs.co.kr',
      category:'learning',
      ages:['elem','mid','high'],
      subjects:['korean','math','science','social'],
      guide: 'EBSëŠ” ìˆ˜ëŠ¥/êµê³¼ ì—°ê³„ ìë£Œê°€ í’ë¶€í•©ë‹ˆë‹¤. ê³¼ëª©ë³„ ì§§ì€ ê°•ì˜ë¡œ ìš”ì•½ í•™ìŠµì— ì í•©í•©ë‹ˆë‹¤. ì¶”ì²œ ì‚¬ìš©ë²•: â‘  ê´€ì‹¬ ê³¼ëª© í”„ë¦¬íŒ¨ìŠ¤ ê°•ì˜ ê³¨ë¼ë³´ê¸° â‘¡ ëª¨ì˜ê³ ì‚¬ ê°•ì˜ë¡œ ì•½ì  ë³´ì™„',
      tips: ['êµê³¼ì„œ ë‹¨ì›ì— ë§ì¶° ì˜ìƒ ì¬ìƒ','ë…¸íŠ¸ì— ìš”ì  ì •ë¦¬ í›„ ë³µìŠµ','ëª¨ì˜ê³ ì‚¬ ì „ EBS ì—°ê³„ ë¬¸ì œ í™•ì¸'],
      expert:true
    },
    {
      id: 'khan',
      name:'Khan Academy (í•œêµ­ì–´)',
      url:'https://ko.khanacademy.org/',
      category:'learning',
      ages:['mid','high','adult'],
      subjects:['math','science'],
      guide:'ê¸°ì´ˆ ê°œë…ì„ ì‰¬ìš´ ì„¤ëª…ìœ¼ë¡œ ë‹¤ì§€ê³  ì‹¶ì€ í•™ìƒì—ê²Œ ìµœì . ë‹¨ê³„ë³„ ë¬¸ì œí’€ì´ê°€ ì²´ê³„ì ì…ë‹ˆë‹¤.',
      tips:['ìˆ˜í•™ ê°œë…ì€ ì˜ˆì œ ë¨¼ì € í’€ì–´ë³´ê¸°','ì˜ìƒ ë³´ë©° ì†ìœ¼ë¡œ ì§ì ‘ í’€ê¸°'],
      expert:false
    },
    {
      id: 'programmers',
      name:'í”„ë¡œê·¸ë˜ë¨¸ìŠ¤',
      url:'https://programmers.co.kr/',
      category:'coding',
      ages:['high','adult'],
      subjects:['coding'],
      guide:'ì½”ë”© ê¸°ì´ˆë¶€í„° ì‹¤ë¬´í˜• ë¬¸ì œê¹Œì§€. ì•Œê³ ë¦¬ì¦˜ ì—°ìŠµìœ¼ë¡œ ë¬¸ì œ í•´ê²° ëŠ¥ë ¥ ê°•í™”.',
      tips:['ë‚œì´ë„ë³„ ë£¨í‹´ ë§Œë“¤ê¸°','ë¬¸ì œ í•´ê²° í›„ í•´ì„¤ ì •ë¦¬'],
      expert:true
    },
    {
      id: 'naver',
      name:'ë„¤ì´ë²„',
      url:'https://www.naver.com/',
      category:'search',
      ages:['elem','mid','high','adult'],
      subjects:['general'],
      guide:'ì¼ìƒì  ê²€ìƒ‰, ì‚¬ì „, ì§€ì‹ì¸ ì´ìš©. ë¦¬í¬íŠ¸ ìë£Œ ì°¾ì„ ë•Œ ì¶œì²˜ í™•ì¸ í•„ìˆ˜.',
      tips:['ê²€ìƒ‰ì–´ì— ë”°ì˜´í‘œ ì‚¬ìš©','ê³ ê¸‰ê²€ìƒ‰(ê¸°ê°„/ë„ë©”ì¸) í™œìš©'],
      expert:false
    },
    {
      id: 'kice',
      name:'í•œêµ­êµìœ¡ê³¼ì •í‰ê°€ì› (ìˆ˜ëŠ¥/ê¸°ì¶œ)',
      url:'https://www.kice.re.kr/',
      category:'exam',
      ages:['high'],
      subjects:['exam'],
      guide:'ìˆ˜ëŠ¥/ëª¨ì˜ê³ ì‚¬ ìë£Œ, ê¸°ì¶œ í™•ì¸ í•„ìˆ˜. ê¸°ì¶œë¶„ì„ìœ¼ë¡œ ì¶œì œê²½í–¥ íŒŒì•…í•˜ê¸°.',
      tips:['ê¸°ì¶œë¬¸ì œë¥¼ ì‹œê°„ ì¬ê³  í’€ê¸°','ì˜¤ë‹µë…¸íŠ¸ë¡œ ìœ í˜• ë¶„ë¥˜'],
      examSeason:true,
      expert:true
    }
  ];

  // ë¡œì»¬ ìƒíƒœ (sites ì‹¤ì œ ì‚¬ìš© ë°ì´í„°)
  let sites = [];
  // ì„ íƒ/í¬ì»¤ìŠ¤ ìƒíƒœ
  let focusedIndex = 0;
  // í˜„ì¬ íƒ­
  let currentTab = 'expert';

  /***********************
   * ì´ˆê¸°í™”
   ***********************/
  function init(){
    // load saved order/data
    const saved = localStorage.getItem('dfm_sites_v1');
    if(saved){
      try{
        const parsed = JSON.parse(saved);
        if(Array.isArray(parsed) && parsed.length) sites = parsed;
        else sites = initialSites;
      }catch(e){ sites = initialSites; }
    } else {
      sites = initialSites;
    }

    renderTabs();
    renderGrid();
    attachEvents();
    highlightFilteredCount();
  }

  /***********************
   * ë Œë”ë§: íƒ­ + ê·¸ë¦¬ë“œ
   ***********************/
  function renderTabs(){
    document.querySelectorAll('.tab').forEach(btn=>{
      btn.classList.toggle('active', btn.dataset.tab === currentTab);
    });
  }

  function getFilteredSites(){
    const q = document.getElementById('search').value.trim().toLowerCase();
    let arr = sites.slice();
    // tab í•„í„°
    if(currentTab === 'expert'){
      arr = arr.filter(s=>s.expert);
    } else if(currentTab === 'season'){
      // exam season detection simple heuristic: if today is within 45 days of Nov 15 (ìˆ˜ëŠ¥) mark examSeason
      const now = new Date();
      const thisYear = now.getFullYear();
      const suneung = new Date(thisYear,10,14); // 11ì›” 15ì¼(0-indexed month 10) ëŒ€ëµ
      const diffDays = Math.abs((suneung - now)/(1000*60*60*24));
      if(diffDays <= 60){
        arr = arr.filter(s=>s.examSeason || s.category==='exam');
      } else {
        // ë°©í•™ ì‹œì¦Œ(7~8ì›”) ì¶”ì²œ
        if(now.getMonth()===6 || now.getMonth()===7){
          arr = arr.filter(s=>s.category==='learning' || s.category==='coding');
        } else {
          arr = arr; // default
        }
      }
    } else if(currentTab === 'grade'){
      // ê°„ë‹¨ UI: í•™ë…„ë³„ ë²„íŠ¼ìœ¼ë¡œ í•„í„° (ì¶”ê°€ êµ¬í˜„ ê°€ëŠ¥). í˜„ì¬ëŠ” ì „ì²´.
      arr = arr;
    }
    if(q){
      arr = arr.filter(s=>{
        const h = (s.name+' '+(s.desc||'')+' '+(s.guide||'')).toLowerCase();
        return h.includes(q);
      });
    }
    return arr;
  }

  function renderGrid(){
    const container = document.getElementById('grid');
    container.innerHTML = '';
    const list = getFilteredSites();
    if(list.length===0){
      container.innerHTML = `<div style="grid-column:1/-1;padding:24px;border-radius:12px;background:var(--card);text-align:center;color:var(--muted)">ì¡°ê±´ì— ë§ëŠ” ì‚¬ì´íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
      return;
    }

    list.forEach((s, idx) => {
      const card = document.createElement('article');
      card.className = 'card';
      card.draggable = true;
      card.dataset.id = s.id;
      // card inner
      card.innerHTML = `
        <div class="card-actions">
          <button class="icon-btn q" title="ë¯¸ë¦¬ë³´ê¸° (P)" data-action="preview">ğŸ‘</button>
          <button class="icon-btn bookmark" title="ê°€ì´ë“œ ë³´ê¸°" data-action="guide">ğŸ“˜</button>
          <a class="icon-btn" title="ìƒˆ íƒ­ì—ì„œ ì—´ê¸°" href="${escapeHtml(s.url)}" target="_blank" rel="noopener" data-action="open">â†—</a>
        </div>
        <div class="title"><span>${escapeHtml(s.name)}</span> <span style="font-size:12px;color:var(--muted);font-weight:600">Â· ${escapeHtml(s.category)}</span></div>
        <div class="desc">${escapeHtml(s.desc || s.guide || '')}</div>
        <div class="meta">
          ${ (s.ages || []).map(a=>`<span class="tag">${escapeHtml(a)}</span>`).join(' ') }
          ${ (s.subjects || []).map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join(' ') }
          <span style="margin-left:auto" class="drag-handle" title="ë“œë˜ê·¸ë¡œ ìˆœì„œ ë³€ê²½">â˜° ìˆœì„œ</span>
        </div>
      `;
      // data
      container.appendChild(card);

      // attach per-card behaviors
      // preview
      card.querySelector('[data-action="preview"]').addEventListener('click', (e)=>{
        openPreview(s);
      });
      // guide
      card.querySelector('[data-action="guide"]').addEventListener('click', (e)=>{
        showGuide(s, card);
      });
      // open (link)
      card.querySelector('[data-action="open"]').addEventListener('click', (e)=>{
        // save recent view
        pushRecent(s);
      });

      // drag events
      addDragHandlers(card);
      // keyboard focus
      card.tabIndex = 0;
      card.addEventListener('focus', ()=>{ focusedIndex = idx; });
    });

    // after render, attempt link health check in background
    setTimeout(()=>{ checkLinksHealth(); }, 600);
  }

  /***********************
   * ê°€ì´ë“œ í‘œì‹œ (ì¹´ë“œ ì•„ë˜ í˜¹ì€ ëª¨ë‹¬)
   ***********************/
  function showGuide(site, cardEl){
    // toggle small panel
    let panel = cardEl.querySelector('.guide-box');
    if(panel){
      panel.remove();
      return;
    }
    panel = document.createElement('div');
    panel.className = 'guide-box';
    panel.style.marginTop = '10px';
    panel.innerHTML = `
      <div style="padding:12px;border-radius:10px;border:1px dashed rgba(0,0,0,0.04);background:linear-gradient(180deg,#fafaff,#fff)">
        <strong>í™œìš© ê°€ì´ë“œ</strong>
        <div style="margin-top:8px;color:var(--muted)">${escapeHtml(site.guide || 'ê°€ì´ë“œê°€ ë“±ë¡ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.')}</div>
        <div style="margin-top:8px"><strong>íŒ</strong>
          <ul style="margin:8px 0 0 18px;color:var(--muted)">${(site.tips||[]).map(t=>`<li>${escapeHtml(t)}</li>`).join('')}</ul>
        </div>
        <div style="margin-top:10px"><strong>ì‚¬ì´íŠ¸ ì¡°í•© ì¶”ì²œ</strong>
          <div style="margin-top:6px;color:var(--muted)">${makeComboRecommendation(site)}</div>
        </div>
      </div>
    `;
    cardEl.appendChild(panel);
  }

  function makeComboRecommendation(site){
    // ê°„ë‹¨ ì¶”ì²œ: ê°™ì€ ê³¼ëª©/ì—°ë ¹ëŒ€ì— í‰íŒ ì¢‹ì€ ë‹¤ë¥¸ ì‚¬ì´íŠ¸ 2ê°œ
    const sameSubject = sites.filter(s=>{
      if(s.id === site.id) return false;
      const inter = (s.subjects||[]).filter(x=> (site.subjects||[]).includes(x));
      return inter.length>0;
    });
    if(sameSubject.length===0) return 'ê´€ë ¨ ì‚¬ì´íŠ¸ê°€ ë” ì—†ìŠµë‹ˆë‹¤.';
    return 'ì˜ˆ: '+sameSubject.slice(0,2).map(x=>`${x.name}`).join(' / ');
  }

  /***********************
   * ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬
   ***********************/
  const previewModal = document.getElementById('previewModal');
  const previewFrame = document.getElementById('previewFrame');
  const modalTitle = document.getElementById('modalTitle');
  document.getElementById('closePreview').addEventListener('click', closePreview);

  function openPreview(site){
    modalTitle.textContent = site.name;
    previewFrame.src = site.url;
    previewModal.classList.add('open');
    previewModal.setAttribute('aria-hidden','false');
  }
  function closePreview(){
    previewFrame.src = 'about:blank';
    previewModal.classList.remove('open');
    previewModal.setAttribute('aria-hidden','true');
  }

  /***********************
   * ë§í¬ ìƒíƒœ í™•ì¸ (ê°€ëŠ¥í•˜ë©´ HEAD ìš”ì²­, ì‹¤íŒ¨ì‹œ 'ì•Œ ìˆ˜ ì—†ìŒ')
   ***********************/
  async function checkLinksHealth(){
    const cardEls = Array.from(document.querySelectorAll('.card'));
    for(const card of cardEls){
      const hrefEl = card.querySelector('a[data-action="open"]');
      if(!hrefEl) continue;
      const url = hrefEl.href;
      // show spinner
      let s = document.createElement('div'); s.className='spinner'; s.style.width='18px'; s.style.height='18px'; s.style.marginLeft='6px';
      hrefEl.parentElement.appendChild(s);
      try{
        const ok = await fetchWithTimeout(url, {method:'HEAD'}, 3000);
        s.remove();
        const badge = document.createElement('span');
        badge.className = 'tag';
        badge.textContent = ok && ok.ok ? 'ì •ìƒ' : 'ì‘ë‹µì—†ìŒ';
        if(!ok || !ok.ok) badge.style.background='linear-gradient(90deg,#f8d7da,#fbe0e6)';
        card.querySelector('.meta').appendChild(badge);
      }catch(err){
        s.remove();
        const badge = document.createElement('span');
        badge.className = 'tag';
        badge.textContent = 'ì•Œ ìˆ˜ ì—†ìŒ';
        badge.style.background='linear-gradient(90deg,#fff3cd,#fff7e6)';
        card.querySelector('.meta').appendChild(badge);
      }
    }
  }

  function fetchWithTimeout(resource, options = {}, timeout = 5000){
    return new Promise((resolve,reject)=>{
      const timer = setTimeout(()=>reject(new Error('timeout')), timeout);
      fetch(resource, options).then(res=>{
        clearTimeout(timer);
        resolve(res);
      }).catch(err=>{
        clearTimeout(timer);
        reject(err);
      });
    });
  }

  /***********************
   * ë“œë˜ê·¸ì•¤ë“œë¡­ ì •ë ¬ (HTML5 drag)
   ***********************/
  function addDragHandlers(card){
    card.addEventListener('dragstart', (e)=>{
      card.classList.add('dragging');
      e.dataTransfer.setData('text/plain', card.dataset.id);
      e.dataTransfer.effectAllowed = 'move';
    });
    card.addEventListener('dragend', (e)=>{
      card.classList.remove('dragging');
      saveOrderToLocal();
      renderGrid(); // re-render to update indices
    });
    card.addEventListener('dragover', (e)=>{
      e.preventDefault();
      const dragging = document.querySelector('.dragging');
      if(!dragging || dragging === card) return;
      const grid = document.getElementById('grid');
      const rect = card.getBoundingClientRect();
      const after = (e.clientY - rect.top) > rect.height/2;
      if(after) grid.insertBefore(dragging, card.nextSibling);
      else grid.insertBefore(dragging, card);
    });
  }

  function saveOrderToLocal(){
    // get current order from DOM
    const ids = Array.from(document.querySelectorAll('.card')).map(c=>c.dataset.id);
    const newOrder = [];
    ids.forEach(id=>{
      const s = sites.find(x=>x.id===id);
      if(s) newOrder.push(s);
    });
    if(newOrder.length) {
      sites = newOrder;
      localStorage.setItem('dfm_sites_v1', JSON.stringify(sites));
      showToast('ì •ë ¬ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
  }

  /***********************
   * ìµœê·¼ ë³¸ ì‚¬ì´íŠ¸ (ê°„ë‹¨ ì €ì¥)
   ***********************/
  function pushRecent(site){
    try{
      let recent = JSON.parse(localStorage.getItem('dfm_recent_v1')||'[]');
      recent = recent.filter(r=>r.id !== site.id);
      recent.unshift({id:site.id,name:site.name,url:site.url,time:Date.now()});
      recent = recent.slice(0,10);
      localStorage.setItem('dfm_recent_v1', JSON.stringify(recent));
    }catch(e){}
  }

  /***********************
   * ìœ í‹¸: XSS ë°©ì§€
   ***********************/
  function escapeHtml(s){ if(!s) return ''; return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

  /***********************
   * í† ìŠ¤íŠ¸
   ***********************/
  function showToast(msg, err=false){
    const el = document.createElement('div');
    el.textContent = msg;
    el.style.position='fixed'; el.style.right='18px'; el.style.bottom='18px';
    el.style.padding='10px 14px'; el.style.borderRadius='12px'; el.style.background= err? '#dc3545' : 'linear-gradient(90deg,#6c63ff,#7b61ff)';
    el.style.color='#fff'; el.style.boxShadow='0 10px 30px rgba(0,0,0,0.18)'; el.style.zIndex=9999;
    document.body.appendChild(el);
    setTimeout(()=>{ el.style.opacity='0'; setTimeout(()=>el.remove(),400); },2500);
  }

  /***********************
   * í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
   ***********************/
  function attachEvents(){
    // tabs click
    document.querySelectorAll('.tab').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        currentTab = btn.dataset.tab;
        renderTabs();
        renderGrid();
      });
    });
    // search
    document.getElementById('search').addEventListener('input', ()=>{
      renderGrid();
    });
    // theme toggle
    document.getElementById('themeToggle').addEventListener('click', toggleTheme);
    // guide toggle
    document.getElementById('guideToggle').addEventListener('click', ()=>{
      const g = document.getElementById('guideArea');
      const vis = g.getAttribute('aria-hidden') === 'true' ? false : false;
      if(g.style.display === 'none' || g.getAttribute('aria-hidden')==='true'){
        g.style.display='block';
        g.setAttribute('aria-hidden','false');
      } else {
        g.style.display='none';
        g.setAttribute('aria-hidden','true');
      }
    });

    // keyboard
    document.addEventListener('keydown', (e)=>{
      if(e.key === '/') { e.preventDefault(); document.getElementById('search').focus(); }
      if(e.key === 'd' || e.key === 'D'){ toggleTheme(); }
      if(e.key === 'g' || e.key === 'G'){ document.getElementById('guideToggle').click(); }
      if(e.key === 'p' || e.key === 'P'){ // preview focused card
        const focused = document.querySelector('.card:focus') || document.querySelector('.card');
        if(focused){
          const id = focused.dataset.id;
          const site = sites.find(s=>s.id===id);
          if(site) openPreview(site);
        }
      }
      // left/right to change tabs (simple)
      if(e.key === 'ArrowLeft' || e.key === 'ArrowRight'){
        const tabButtons = Array.from(document.querySelectorAll('.tab'));
        const curIdx = tabButtons.findIndex(b=>b.classList.contains('active'));
        let next = curIdx;
        if(e.key === 'ArrowLeft') next = Math.max(0, curIdx-1);
        if(e.key === 'ArrowRight') next = Math.min(tabButtons.length-1, curIdx+1);
        if(tabButtons[next]) tabButtons[next].click();
      }
    });

    // modal close by ESC
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closePreview(); });

    // click outside preview to close
    previewModal.addEventListener('click', (ev)=>{
      if(ev.target === previewModal) closePreview();
    });
  }

  /***********************
   * í…Œë§ˆ ì €ì¥/í† ê¸€
   ***********************/
  function toggleTheme(){
    const el = document.body;
    const cur = el.getAttribute('data-theme') || 'light';
    const next = cur === 'light' ? 'dark' : 'light';
    el.setAttribute('data-theme', next);
    localStorage.setItem('dfm_theme_v1', next);
  }
  (function loadTheme(){
    const saved = localStorage.getItem('dfm_theme_v1');
    if(saved) document.body.setAttribute('data-theme', saved);
  })();

  /***********************
   * UI ë³´ì¡°: í•„í„° ê²°ê³¼ ì¹´ìš´íŠ¸
   ***********************/
  function highlightFilteredCount(){
    // small quick info in guide area
    const cnt = getFilteredSites().length;
    document.getElementById('guideSummary').textContent = `í˜„ì¬ ${cnt}ê°œ ì‚¬ì´íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤. '/'ë¡œ ê²€ìƒ‰, ë“œë˜ê·¸ë¡œ ì •ë ¬ ê°€ëŠ¥.`;
  }

  // re-highlight after render
  const origRenderGrid = renderGrid;
  renderGrid = function(){ origRenderGrid(); highlightFilteredCount(); };

  // init
  init();
  </script>
</body>
</html>
